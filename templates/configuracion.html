{% extends "base.html" %}

{% block title %}Configuraci√≥n - Iberdrola AI{% endblock %}

{% block content %}
<div class="use-case-container">
    <!-- Editor de Men√∫ -->
    <div class="card">
        <div class="card-header">
            <h2>üìù Editor de Men√∫ de Navegaci√≥n</h2>
            <p style="font-size: 14px; color: var(--neutral-foreground-3); margin-top: 8px;">
                Personaliza los nombres y t√≠tulos del men√∫. Los cambios se guardan autom√°ticamente.
            </p>
        </div>
        <div class="card-body">
            <div id="menu-editor">
                <!-- Dashboard -->
                <div class="menu-editor-section">
                    <h3 class="menu-editor-title">Dashboard</h3>
                    <div class="menu-editor-item">
                        <div class="form-group">
                            <label>Nombre en Men√∫</label>
                            <input type="text" class="form-control" 
                                   data-config-path="dashboard.menu_name" 
                                   value="{{ menu_config.dashboard.menu_name }}">
                        </div>
                        <div class="form-group">
                            <label>T√≠tulo de P√°gina</label>
                            <input type="text" class="form-control" 
                                   data-config-path="dashboard.page_title" 
                                   value="{{ menu_config.dashboard.page_title }}">
                        </div>
                    </div>
                </div>

                <!-- Categor√≠as -->
                {% for category in menu_config.categories %}
                {% set category_index = loop.index0 %}
                <div class="menu-editor-section">
                    <h3 class="menu-editor-title">
                        <input type="text" class="form-control category-title-input" 
                               data-config-path="categories.{{ category_index }}.title" 
                               value="{{ category.title }}">
                    </h3>
                    
                    {% for item in category.menu_items %}
                    <div class="menu-editor-item">
                        <div class="menu-item-header">
                            <span class="menu-item-icon">{{ item.icon }}</span>
                            <span class="menu-item-endpoint">{{ item.endpoint }}</span>
                        </div>
                        <div class="form-group">
                            <label>Nombre en Men√∫</label>
                            <input type="text" class="form-control" 
                                   data-config-path="categories.{{ category_index }}.menu_items.{{ loop.index0 }}.menu_name" 
                                   value="{{ item.menu_name }}">
                        </div>
                        <div class="form-group">
                            <label>T√≠tulo de P√°gina</label>
                            <input type="text" class="form-control" 
                                   data-config-path="categories.{{ category_index }}.menu_items.{{ loop.index0 }}.page_title" 
                                   value="{{ item.page_title }}">
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% endfor %}

                <!-- Configuraci√≥n -->
                <div class="menu-editor-section">
                    <h3 class="menu-editor-title">Configuraci√≥n</h3>
                    <div class="menu-editor-item">
                        <div class="form-group">
                            <label>Nombre en Men√∫</label>
                            <input type="text" class="form-control" 
                                   data-config-path="configuracion.menu_name" 
                                   value="{{ menu_config.configuracion.menu_name }}">
                        </div>
                        <div class="form-group">
                            <label>T√≠tulo de P√°gina</label>
                            <input type="text" class="form-control" 
                                   data-config-path="configuracion.page_title" 
                                   value="{{ menu_config.configuracion.page_title }}">
                        </div>
                    </div>
                </div>
            </div>

            <div class="menu-editor-actions">
                <button id="save-menu-config" class="btn btn-primary">
                    üíæ Guardar Configuraci√≥n
                </button>
                <button id="reset-menu-config" class="btn btn-secondary">
                    üîÑ Restaurar Valores por Defecto
                </button>
                <div id="save-status" class="save-status"></div>
            </div>
        </div>
    </div>

    <!-- Configuraci√≥n General -->
    <div class="card">
        <div class="card-header">
            <h2>‚öôÔ∏è Configuraci√≥n General</h2>
        </div>
        <div class="card-body">
            <form>
                <div class="form-group">
                    <label>Nombre de la Empresa</label>
                    <input type="text" class="form-control" value="Iberdrola Espa√±a">
                </div>
                <div class="form-group">
                    <label>Idioma</label>
                    <select class="form-control">
                        <option selected>Espa√±ol</option>
                        <option>English</option>
                        <option>Portugu√™s</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Zona Horaria</label>
                    <select class="form-control">
                        <option selected>Europe/Madrid (GMT+1)</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary">Guardar Cambios</button>
            </form>
        </div>
    </div>

    <!-- Seguridad -->
    <div class="card">
        <div class="card-header">
            <h2>üîí Seguridad y Privacidad</h2>
        </div>
        <div class="card-body">
            <div class="security-item">
                <div>
                    <strong>Autenticaci√≥n de Dos Factores</strong>
                    <p>Protege tu cuenta con verificaci√≥n adicional</p>
                </div>
                <label class="toggle">
                    <input type="checkbox" checked>
                    <span class="toggle-slider"></span>
                </label>
            </div>
            <div class="security-item">
                <div>
                    <strong>Certificaci√≥n ISO/IEC 42001</strong>
                    <p>Sistema de Gesti√≥n de IA Certificado</p>
                </div>
                <span class="badge badge-success">‚úì Activo</span>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const saveBtn = document.getElementById('save-menu-config');
    const resetBtn = document.getElementById('reset-menu-config');
    const saveStatus = document.getElementById('save-status');
    
    // Guardar configuraci√≥n
    saveBtn.addEventListener('click', async function() {
        const inputs = document.querySelectorAll('#menu-editor input[data-config-path]');
        const config = {{ menu_config|tojson }};
        
        // Actualizar configuraci√≥n con los valores de los inputs
        inputs.forEach(input => {
            const path = input.dataset.configPath.split('.');
            let obj = config;
            
            for (let i = 0; i < path.length - 1; i++) {
                obj = obj[path[i]];
            }
            
            obj[path[path.length - 1]] = input.value;
        });
        
        // Enviar al servidor
        try {
            const response = await fetch('/api/save-menu-config', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(config)
            });
            
            if (response.ok) {
                saveStatus.innerHTML = '<span style="color: var(--success-color);">‚úì Guardado correctamente</span>';
                setTimeout(() => {
                    window.location.reload();
                }, 1000);
            } else {
                saveStatus.innerHTML = '<span style="color: var(--error-color);">‚úó Error al guardar</span>';
            }
        } catch (error) {
            saveStatus.innerHTML = '<span style="color: var(--error-color);">‚úó Error de conexi√≥n</span>';
        }
    });
    
    // Restaurar valores por defecto
    resetBtn.addEventListener('click', function() {
        if (confirm('¬øEst√°s seguro de que quieres restaurar los valores por defecto?')) {
            fetch('/api/reset-menu-config', {
                method: 'POST'
            }).then(() => {
                window.location.reload();
            });
        }
    });
});
</script>
{% endblock %}
