{% extends "base.html" %}

{% block title %}ConfiguraciÃ³n - Iberdrola AI{% endblock %}

{% block content %}
<div class="use-case-container">
    <!-- Editor de MenÃº -->
    <div class="card">
        <div class="card-header">
            <h2>ğŸ“ Editor de MenÃº de NavegaciÃ³n</h2>
            <p style="font-size: 14px; color: var(--neutral-foreground-3); margin-top: 8px;">
                Personaliza los nombres y tÃ­tulos del menÃº. Los cambios se guardan automÃ¡ticamente.
            </p>
        </div>
        <div class="card-body">
            <div id="menu-editor">
                <!-- Dashboard -->
                <div class="menu-editor-section">
                    <h3 class="menu-editor-title">Dashboard</h3>
                    <div class="menu-editor-item">
                        <div class="form-group">
                            <label>Nombre en MenÃº</label>
                            <input type="text" class="form-control" 
                                   data-config-path="dashboard.menu_name" 
                                   value="{{ menu_config.dashboard.menu_name }}">
                        </div>
                        <div class="form-group">
                            <label>TÃ­tulo de PÃ¡gina</label>
                            <input type="text" class="form-control" 
                                   data-config-path="dashboard.page_title" 
                                   value="{{ menu_config.dashboard.page_title }}">
                        </div>
                    </div>
                </div>

                <!-- CategorÃ­as -->
                {% for category in menu_config.categories %}
                {% set category_index = loop.index0 %}
                <div class="menu-editor-section">
                    <h3 class="menu-editor-title">
                        <input type="text" class="form-control category-title-input" 
                               data-config-path="categories.{{ category_index }}.title" 
                               value="{{ category.title }}">
                    </h3>
                    
                    {% for item in category.menu_items %}
                    <div class="menu-editor-item">
                        <div class="menu-item-header">
                            <span class="menu-item-icon">{{ item.icon }}</span>
                            <span class="menu-item-endpoint">{{ item.endpoint }}</span>
                        </div>
                        <div class="form-group">
                            <label>Nombre en MenÃº</label>
                            <input type="text" class="form-control" 
                                   data-config-path="categories.{{ category_index }}.menu_items.{{ loop.index0 }}.menu_name" 
                                   value="{{ item.menu_name }}">
                        </div>
                        <div class="form-group">
                            <label>TÃ­tulo de PÃ¡gina</label>
                            <input type="text" class="form-control" 
                                   data-config-path="categories.{{ category_index }}.menu_items.{{ loop.index0 }}.page_title" 
                                   value="{{ item.page_title }}">
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% endfor %}

                <!-- ConfiguraciÃ³n -->
                <div class="menu-editor-section">
                    <h3 class="menu-editor-title">ConfiguraciÃ³n</h3>
                    <div class="menu-editor-item">
                        <div class="form-group">
                            <label>Nombre en MenÃº</label>
                            <input type="text" class="form-control" 
                                   data-config-path="configuracion.menu_name" 
                                   value="{{ menu_config.configuracion.menu_name }}">
                        </div>
                        <div class="form-group">
                            <label>TÃ­tulo de PÃ¡gina</label>
                            <input type="text" class="form-control" 
                                   data-config-path="configuracion.page_title" 
                                   value="{{ menu_config.configuracion.page_title }}">
                        </div>
                    </div>
                </div>
            </div>

            <div class="menu-editor-actions">
                <button id="save-menu-config" class="btn btn-primary">
                    ğŸ’¾ Guardar ConfiguraciÃ³n
                </button>
                <button id="reset-menu-config" class="btn btn-secondary">
                    ğŸ”„ Restaurar Valores por Defecto
                </button>
                <div id="save-status" class="save-status"></div>
            </div>
        </div>
    </div>

    <!-- Vista del MenÃº -->
    <div class="card">
        <div class="card-header">
            <h2>ğŸ—‚ï¸ OrganizaciÃ³n del MenÃº</h2>
            <p style="font-size: 14px; color: var(--neutral-foreground-3); margin-top: 8px;">
                Configura cÃ³mo se agrupan los casos de uso en el menÃº lateral
            </p>
        </div>
        <div class="card-body">
            <div class="menu-view-selector">
                <div class="view-option" data-view="category">
                    <div class="view-option-header">
                        <input type="radio" name="menu_view" id="view_category" value="category" 
                               {% if menu_config.menu_view_mode == 'category' %}checked{% endif %}>
                        <label for="view_category">
                            <strong>ğŸ“ Por CategorÃ­a</strong>
                        </label>
                    </div>
                    <p class="view-option-description">
                        Agrupa los casos de uso por tipo: Customer Engagement, Content & Creative, Campaign Optimization, Customer Intelligence
                    </p>
                    <div class="view-option-preview">
                        <div class="preview-item">ğŸ“Š Customer Engagement</div>
                        <div class="preview-subitem">â†’ PersonalizaciÃ³n, Recomendaciones, Chatbot</div>
                        <div class="preview-item">âœï¸ Content & Creative</div>
                        <div class="preview-subitem">â†’ GeneraciÃ³n GenAI, MonitorizaciÃ³n</div>
                    </div>
                </div>

                <div class="view-option" data-view="roadmap">
                    <div class="view-option-header">
                        <input type="radio" name="menu_view" id="view_roadmap" value="roadmap"
                               {% if menu_config.menu_view_mode == 'roadmap' %}checked{% endif %}>
                        <label for="view_roadmap">
                            <strong>ğŸš€ Por Roadmap</strong>
                        </label>
                    </div>
                    <p class="view-option-description">
                        Agrupa los casos de uso por fase de implementaciÃ³n: Quick Wins (AÃ±o 1) vs AÃ±o 2+
                    </p>
                    <div class="view-option-preview">
                        <div class="preview-item" style="color: #10b981;">ğŸš€ Quick Wins (AÃ±o 1)</div>
                        <div class="preview-subitem">â†’ 4 casos de uso de rÃ¡pida implementaciÃ³n</div>
                        <div class="preview-item" style="color: #3b82f6;">ğŸ¯ AÃ±o 2+ Wins</div>
                        <div class="preview-subitem">â†’ 6 casos de uso estratÃ©gicos</div>
                    </div>
                </div>
            </div>

            <div class="roadmap-info-box">
                <h4>ğŸ“‹ DistribuciÃ³n por Roadmap:</h4>
                <div class="roadmap-distribution">
                    <div class="roadmap-group quick-wins">
                        <h5>ğŸš€ Quick Wins (AÃ±o 1)</h5>
                        <ul>
                            <li>ğŸ’¬ Agentes Conversacionales</li>
                            <li>âœï¸ GeneraciÃ³n de contenido con GenAI</li>
                            <li>ğŸ“¡ MonitorizaciÃ³n de marca</li>
                            <li>ğŸ§ª A/B Testing Automatizado</li>
                        </ul>
                        <p class="roadmap-note">Baja dependencia de datos â€¢ ImplementaciÃ³n rÃ¡pida â€¢ Valor inmediato</p>
                    </div>
                    <div class="roadmap-group year-2-plus">
                        <h5>ğŸ¯ AÃ±o 2+ Wins</h5>
                        <ul>
                            <li>ğŸ‘¤ PersonalizaciÃ³n de experiencias</li>
                            <li>ğŸ Motor de recomendaciones</li>
                            <li>ğŸ¯ OptimizaciÃ³n Publicitaria</li>
                            <li>ğŸ”— Modelos de atribuciÃ³n</li>
                            <li>ğŸ” SegmentaciÃ³n de clientes</li>
                            <li>ğŸ“ˆ PredicciÃ³n de abandonos</li>
                        </ul>
                        <p class="roadmap-note">Alta dependencia de datos â€¢ IntegraciÃ³n profunda â€¢ VisiÃ³n estratÃ©gica</p>
                    </div>
                </div>
            </div>

            <button id="save-menu-view" class="btn btn-primary">
                ğŸ’¾ Aplicar Vista de MenÃº
            </button>
            <div id="view-save-status" class="save-status"></div>
        </div>
    </div>

    <!-- ConfiguraciÃ³n General -->
    <div class="card">
        <div class="card-header">
            <h2>âš™ï¸ ConfiguraciÃ³n General</h2>
        </div>
        <div class="card-body">
            <form>
                <div class="form-group">
                    <label>Nombre de la Empresa</label>
                    <input type="text" class="form-control" value="Iberdrola EspaÃ±a">
                </div>
                <div class="form-group">
                    <label>Idioma</label>
                    <select class="form-control">
                        <option selected>EspaÃ±ol</option>
                        <option>English</option>
                        <option>PortuguÃªs</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Zona Horaria</label>
                    <select class="form-control">
                        <option selected>Europe/Madrid (GMT+1)</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary">Guardar Cambios</button>
            </form>
        </div>
    </div>

    <!-- Seguridad -->
    <div class="card">
        <div class="card-header">
            <h2>ğŸ”’ Seguridad y Privacidad</h2>
        </div>
        <div class="card-body">
            <div class="security-item">
                <div>
                    <strong>AutenticaciÃ³n de Dos Factores</strong>
                    <p>Protege tu cuenta con verificaciÃ³n adicional</p>
                </div>
                <label class="toggle">
                    <input type="checkbox" checked>
                    <span class="toggle-slider"></span>
                </label>
            </div>
            <div class="security-item">
                <div>
                    <strong>CertificaciÃ³n ISO/IEC 42001</strong>
                    <p>Sistema de GestiÃ³n de IA Certificado</p>
                </div>
                <span class="badge badge-success">âœ“ Activo</span>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const saveBtn = document.getElementById('save-menu-config');
    const resetBtn = document.getElementById('reset-menu-config');
    const saveStatus = document.getElementById('save-status');
    const saveViewBtn = document.getElementById('save-menu-view');
    const viewSaveStatus = document.getElementById('view-save-status');
    
    // Guardar vista de menÃº
    saveViewBtn.addEventListener('click', async function() {
        const selectedView = document.querySelector('input[name="menu_view"]:checked').value;
        
        try {
            const response = await fetch('/api/set-menu-view', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ view_mode: selectedView })
            });
            
            if (response.ok) {
                viewSaveStatus.innerHTML = '<span style="color: var(--success-color);">âœ“ Vista aplicada correctamente</span>';
                setTimeout(() => {
                    window.location.reload();
                }, 1000);
            } else {
                viewSaveStatus.innerHTML = '<span style="color: var(--error-color);">âœ— Error al cambiar vista</span>';
            }
        } catch (error) {
            viewSaveStatus.innerHTML = '<span style="color: var(--error-color);">âœ— Error de conexiÃ³n</span>';
        }
    });
    
    // Guardar configuraciÃ³n
    saveBtn.addEventListener('click', async function() {
        const inputs = document.querySelectorAll('#menu-editor input[data-config-path]');
        const config = {{ menu_config|tojson }};
        
        // Actualizar configuraciÃ³n con los valores de los inputs
        inputs.forEach(input => {
            const path = input.dataset.configPath.split('.');
            let obj = config;
            
            for (let i = 0; i < path.length - 1; i++) {
                obj = obj[path[i]];
            }
            
            obj[path[path.length - 1]] = input.value;
        });
        
        // Enviar al servidor
        try {
            const response = await fetch('/api/save-menu-config', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(config)
            });
            
            if (response.ok) {
                saveStatus.innerHTML = '<span style="color: var(--success-color);">âœ“ Guardado correctamente</span>';
                setTimeout(() => {
                    window.location.reload();
                }, 1000);
            } else {
                saveStatus.innerHTML = '<span style="color: var(--error-color);">âœ— Error al guardar</span>';
            }
        } catch (error) {
            saveStatus.innerHTML = '<span style="color: var(--error-color);">âœ— Error de conexiÃ³n</span>';
        }
    });
    
    // Restaurar valores por defecto
    resetBtn.addEventListener('click', function() {
        if (confirm('Â¿EstÃ¡s seguro de que quieres restaurar los valores por defecto?')) {
            fetch('/api/reset-menu-config', {
                method: 'POST'
            }).then(() => {
                window.location.reload();
            });
        }
    });
});
</script>

<!-- Incluir Asistente Virtual Fijo -->
{% include 'asistente_panel_fijo.html' %}

{% endblock %}
