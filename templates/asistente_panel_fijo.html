<!-- Panel Fijo de Asistente Virtual -->
<div class="assistant-fixed-panel">
    <div class="assistant-fixed-header">
        <div class="assistant-avatar-large">
            <div class="avatar-circle-large">
                <span class="avatar-icon-large">ðŸ¤–</span>
                <div class="avatar-status-large"></div>
            </div>
        </div>
        <div class="assistant-title-section">
            <h2 class="assistant-title">Asistente IA</h2>
            <p class="assistant-subtitle">En lÃ­nea â€¢ Listo para ayudar</p>
        </div>
    </div>

    <div class="assistant-welcome-section">
        <div class="welcome-emoji">ðŸ‘‹</div>
        <h3>Â¡Hola! Soy tu asistente virtual</h3>
        <p>Estoy aquÃ­ para ayudarte a navegar y aprovechar al mÃ¡ximo esta plataforma.</p>
    </div>

    <div class="assistant-chat-container" id="assistantChatContainer">
        <!-- Mensaje inicial -->
        <div class="chat-message assistant-msg">
            <div class="msg-avatar">ðŸ¤–</div>
            <div class="msg-bubble">
                <p>Â¿En quÃ© puedo ayudarte hoy?</p>
                <span class="msg-time">Ahora</span>
            </div>
        </div>
    </div>

    <div class="assistant-suggestions-section">
        <div class="suggestions-header">Sugerencias rÃ¡pidas:</div>
        <div class="suggestions-grid">
            <button class="suggestion-card" onclick="askAssistantFixed('Â¿CÃ³mo funciona esta secciÃ³n?')">
                <span class="suggestion-icon">ðŸ’¡</span>
                <span class="suggestion-text">Â¿CÃ³mo funciona esta secciÃ³n?</span>
            </button>
            <button class="suggestion-card" onclick="askAssistantFixed('Â¿QuÃ© puedo hacer aquÃ­?')">
                <span class="suggestion-icon">ðŸŽ¯</span>
                <span class="suggestion-text">Â¿QuÃ© puedo hacer aquÃ­?</span>
            </button>
            <button class="suggestion-card" onclick="askAssistantFixed('MuÃ©strame un ejemplo')">
                <span class="suggestion-icon">ðŸ“Š</span>
                <span class="suggestion-text">MuÃ©strame un ejemplo</span>
            </button>
            <button class="suggestion-card" onclick="askAssistantFixed('Â¿CÃ³mo integro esto?')">
                <span class="suggestion-icon">ðŸ”Œ</span>
                <span class="suggestion-text">Â¿CÃ³mo integro esto?</span>
            </button>
        </div>
    </div>

    <div class="assistant-input-section">
        <input 
            type="text" 
            class="assistant-text-input" 
            id="assistantFixedInput"
            placeholder="Escribe tu pregunta..."
            onkeypress="handleAssistantFixedKeyPress(event)"
        />
        <button class="assistant-send-button" onclick="sendAssistantFixedMessage()">
            <span>ðŸ“¤</span>
        </button>
    </div>
</div>

<style>
/* Panel Fijo del Asistente */
.assistant-fixed-panel {
    position: fixed;
    right: 0;
    top: 0;
    width: 420px;
    height: 100vh;
    background: white;
    border-left: 1px solid #e0e0e0;
    display: flex;
    flex-direction: column;
    z-index: 100;
    box-shadow: -4px 0 12px rgba(0, 0, 0, 0.05);
}

/* Ajustar el contenido principal para dejar espacio al panel */
.main-content {
    margin-right: 420px !important;
}

.assistant-fixed-header {
    padding: 24px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    display: flex;
    align-items: center;
    gap: 16px;
}

.assistant-avatar-large {
    position: relative;
}

.avatar-circle-large {
    width: 64px;
    height: 64px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
}

.avatar-icon-large {
    font-size: 32px;
}

.avatar-status-large {
    position: absolute;
    bottom: 4px;
    right: 4px;
    width: 16px;
    height: 16px;
    background: #4caf50;
    border: 3px solid white;
    border-radius: 50%;
    animation: pulse-status-large 2s infinite;
}

@keyframes pulse-status-large {
    0%, 100% { 
        opacity: 1;
        transform: scale(1);
    }
    50% { 
        opacity: 0.7;
        transform: scale(1.1);
    }
}

.assistant-title-section {
    flex: 1;
}

.assistant-title {
    margin: 0;
    font-size: 22px;
    font-weight: 700;
    color: white;
}

.assistant-subtitle {
    margin: 4px 0 0 0;
    font-size: 14px;
    opacity: 0.9;
    color: white;
}

.assistant-welcome-section {
    padding: 32px 24px;
    text-align: center;
    background: linear-gradient(to bottom, #f8f9ff, white);
    border-bottom: 1px solid #e0e0e0;
}

.welcome-emoji {
    font-size: 56px;
    margin-bottom: 16px;
    animation: wave 2s ease-in-out infinite;
}

@keyframes wave {
    0%, 100% { transform: rotate(0deg); }
    25% { transform: rotate(20deg); }
    75% { transform: rotate(-20deg); }
}

.assistant-welcome-section h3 {
    margin: 0 0 12px 0;
    font-size: 20px;
    color: #333;
    font-weight: 600;
}

.assistant-welcome-section p {
    margin: 0;
    font-size: 14px;
    color: #666;
    line-height: 1.6;
}

.assistant-chat-container {
    flex: 1;
    overflow-y: auto;
    padding: 24px;
    display: flex;
    flex-direction: column;
    gap: 16px;
    background: #fafafa;
}

.chat-message {
    display: flex;
    gap: 12px;
    animation: fadeInUp 0.4s ease;
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.msg-avatar {
    width: 40px;
    height: 40px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    flex-shrink: 0;
}

.user-msg .msg-avatar {
    background: #e0e0e0;
    order: 2;
}

.msg-bubble {
    flex: 1;
    background: white;
    padding: 14px 16px;
    border-radius: 16px;
    border-top-left-radius: 4px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
}

.user-msg .msg-bubble {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-top-left-radius: 16px;
    border-top-right-radius: 4px;
}

.msg-bubble p {
    margin: 0 0 6px 0;
    font-size: 14px;
    line-height: 1.6;
}

.msg-time {
    font-size: 11px;
    color: #999;
    font-weight: 500;
}

.user-msg .msg-time {
    color: rgba(255, 255, 255, 0.8);
}

.assistant-suggestions-section {
    padding: 20px 24px;
    background: white;
    border-top: 1px solid #e0e0e0;
}

.suggestions-header {
    font-size: 13px;
    font-weight: 700;
    color: #666;
    margin-bottom: 12px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.suggestions-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
}

.suggestion-card {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    padding: 16px 12px;
    background: #f8f9ff;
    border: 2px solid #e8ebff;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.3s ease;
    text-align: center;
}

.suggestion-card:hover {
    background: white;
    border-color: #667eea;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
}

.suggestion-icon {
    font-size: 24px;
}

.suggestion-text {
    font-size: 12px;
    color: #333;
    font-weight: 500;
    line-height: 1.3;
}

.assistant-input-section {
    display: flex;
    gap: 12px;
    padding: 20px 24px;
    background: white;
    border-top: 1px solid #e0e0e0;
}

.assistant-text-input {
    flex: 1;
    padding: 14px 16px;
    border: 2px solid #e0e0e0;
    border-radius: 12px;
    font-size: 14px;
    outline: none;
    transition: all 0.3s ease;
    font-family: inherit;
}

.assistant-text-input:focus {
    border-color: #667eea;
    box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
}

.assistant-send-button {
    width: 52px;
    height: 52px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border: none;
    border-radius: 12px;
    color: white;
    font-size: 20px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
}

.assistant-send-button:hover {
    transform: scale(1.05);
    box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
}

.assistant-send-button:active {
    transform: scale(0.95);
}

.typing-indicator-fixed {
    display: flex;
    gap: 6px;
    padding: 12px 16px;
}

.typing-dot-fixed {
    width: 10px;
    height: 10px;
    background: #999;
    border-radius: 50%;
    animation: typing-fixed 1.4s infinite;
}

.typing-dot-fixed:nth-child(2) {
    animation-delay: 0.2s;
}

.typing-dot-fixed:nth-child(3) {
    animation-delay: 0.4s;
}

@keyframes typing-fixed {
    0%, 60%, 100% {
        transform: translateY(0);
        opacity: 0.5;
    }
    30% {
        transform: translateY(-12px);
        opacity: 1;
    }
}

/* Scrollbar personalizado */
.assistant-chat-container::-webkit-scrollbar {
    width: 8px;
}

.assistant-chat-container::-webkit-scrollbar-track {
    background: #f1f1f1;
}

.assistant-chat-container::-webkit-scrollbar-thumb {
    background: #c0c0c0;
    border-radius: 4px;
}

.assistant-chat-container::-webkit-scrollbar-thumb:hover {
    background: #a0a0a0;
}

/* Responsive */
@media (max-width: 1400px) {
    .assistant-fixed-panel {
        width: 360px;
    }
    
    .main-content {
        margin-right: 360px !important;
    }
}

@media (max-width: 1200px) {
    .assistant-fixed-panel {
        display: none;
    }
    
    .main-content {
        margin-right: 0 !important;
    }
}
</style>

<script>
// Respuestas contextuales segÃºn la pÃ¡gina
const assistantFixedResponses = {
    'dashboard': {
        'Â¿CÃ³mo funciona esta secciÃ³n?': 'La Torre de Control es tu centro de mando principal. AquÃ­ puedes ver mÃ©tricas clave en tiempo real, monitorear el rendimiento de tus campaÃ±as y acceder rÃ¡pidamente a todas las funcionalidades de IA.',
        'Â¿QuÃ© puedo hacer aquÃ­?': 'Puedes: 1) Monitorear KPIs en tiempo real, 2) Ver el rendimiento semanal, 3) Acceder a casos de uso activos, 4) Revisar alertas y notificaciones, 5) Navegar a cualquier mÃ³dulo desde los accesos rÃ¡pidos.',
        'MuÃ©strame un ejemplo': 'Por ejemplo, si ves que el engagement ha bajado un 5%, puedes hacer clic en "PredicciÃ³n de Churn" para identificar clientes en riesgo y tomar acciÃ³n inmediata.',
        'Â¿CÃ³mo integro esto?': 'Ve a la secciÃ³n "IntegraciÃ³n" en el menÃº lateral para ver cÃ³mo conectar el dashboard con tus sistemas existentes mediante APIs REST.'
    },
    'integracion_datos': {
        'Â¿CÃ³mo funciona esta secciÃ³n?': 'AquÃ­ gestionas todas las fuentes de datos conectadas a la plataforma. Puedes ver el estado de cada conexiÃ³n, la frecuencia de sincronizaciÃ³n y quÃ© casos de uso utilizan cada fuente.',
        'Â¿QuÃ© puedo hacer aquÃ­?': 'Puedes: 1) Ver todas las fuentes de datos conectadas, 2) Monitorear el estado de sincronizaciÃ³n, 3) Revisar el volumen de registros, 4) Identificar quÃ© casos de uso usan cada fuente, 5) Configurar nuevas conexiones.',
        'MuÃ©strame un ejemplo': 'Por ejemplo, si conectas tu CRM con 2.5M de registros, automÃ¡ticamente estarÃ¡ disponible para los casos de uso de SegmentaciÃ³n, Churn y PersonalizaciÃ³n.',
        'Â¿CÃ³mo integro esto?': 'Usamos conectores estÃ¡ndar para CRM, ERP, Analytics y mÃ¡s. TambiÃ©n ofrecemos APIs personalizadas y webhooks para integraciones especÃ­ficas.'
    },
    'integracion_apis': {
        'Â¿CÃ³mo funciona esta secciÃ³n?': 'Esta secciÃ³n muestra cÃ³mo los resultados de los modelos de IA se pueden integrar en tus aplicaciones empresariales mediante APIs REST.',
        'Â¿QuÃ© puedo hacer aquÃ­?': 'Puedes: 1) Ver todos los endpoints disponibles, 2) Revisar mÃ©tricas de uso y rendimiento, 3) Copiar cÃ³digo de ejemplo, 4) Ver quÃ© aplicaciones estÃ¡n integradas, 5) Probar las APIs en tiempo real.',
        'MuÃ©strame un ejemplo': 'Por ejemplo, puedes llamar al endpoint /api/v1/churn/predict desde tu CRM para obtener la probabilidad de churn de un cliente en tiempo real.',
        'Â¿CÃ³mo integro esto?': 'Cada endpoint tiene ejemplos en Python, JavaScript y cURL. TambiÃ©n proporcionamos SDKs oficiales y documentaciÃ³n completa de OpenAPI.'
    },
    'laboratorio': {
        'Â¿CÃ³mo funciona esta secciÃ³n?': 'El Laboratorio es tu espacio de experimentaciÃ³n. AquÃ­ puedes conectarte a las fuentes de datos, escribir cÃ³digo Python, ejecutar anÃ¡lisis exploratorios y crear visualizaciones personalizadas.',
        'Â¿QuÃ© puedo hacer aquÃ­?': 'Puedes: 1) Ejecutar notebooks Jupyter, 2) Conectarte a cualquier fuente de datos, 3) Usar librerÃ­as de ML (pandas, sklearn, etc.), 4) Crear visualizaciones, 5) Compartir anÃ¡lisis con tu equipo.',
        'MuÃ©strame un ejemplo': 'Por ejemplo, puedes cargar datos de campaÃ±as, hacer un anÃ¡lisis de correlaciÃ³n entre variables y crear un modelo predictivo personalizado.',
        'Â¿CÃ³mo integro esto?': 'Los notebooks pueden acceder a todas las fuentes de datos conectadas. TambiÃ©n puedes exportar tus anÃ¡lisis como APIs o integrarlos en los flujos de trabajo existentes.'
    },
    'monitorizacion': {
        'Â¿CÃ³mo funciona esta secciÃ³n?': 'AquÃ­ monitorizas el estado de salud de toda la plataforma: rendimiento de modelos, uso de recursos, logs de actividad y auditorÃ­a de operaciones.',
        'Â¿QuÃ© puedo hacer aquÃ­?': 'Puedes: 1) Ver mÃ©tricas del sistema en tiempo real, 2) Revisar logs de actividad, 3) Monitorear el rendimiento de modelos, 4) Detectar anomalÃ­as, 5) Auditar operaciones de usuarios.',
        'MuÃ©strame un ejemplo': 'Por ejemplo, si un modelo de recomendaciÃ³n tiene una precisiÃ³n inferior al 85%, recibirÃ¡s una alerta automÃ¡tica para reentrenarlo.',
        'Â¿CÃ³mo integro esto?': 'Puedes integrar las mÃ©tricas con herramientas como Grafana, Datadog o Prometheus mediante nuestras APIs de monitorizaciÃ³n.'
    },
    'configuracion': {
        'Â¿CÃ³mo funciona esta secciÃ³n?': 'AquÃ­ configuras todos los aspectos de la plataforma: usuarios, permisos, integraciones, notificaciones y preferencias generales.',
        'Â¿QuÃ© puedo hacer aquÃ­?': 'Puedes: 1) Gestionar usuarios y roles, 2) Configurar integraciones, 3) Personalizar notificaciones, 4) Ajustar lÃ­mites de uso, 5) Configurar polÃ­ticas de seguridad.',
        'MuÃ©strame un ejemplo': 'Por ejemplo, puedes crear un rol "Analista de Marketing" con acceso solo a visualizaciÃ³n de datos, sin permisos de ediciÃ³n.',
        'Â¿CÃ³mo integro esto?': 'Soportamos SSO (SAML, OAuth), LDAP/Active Directory y gestiÃ³n de usuarios mediante API para sincronizaciÃ³n automÃ¡tica.'
    },
    'introduccion': {
        'Â¿CÃ³mo funciona esta secciÃ³n?': 'Esta es la documentaciÃ³n tÃ©cnica completa de la plataforma. AquÃ­ encontrarÃ¡s informaciÃ³n detallada sobre cada caso de uso, arquitectura del sistema, enfoque de IA y mejores prÃ¡cticas.',
        'Â¿QuÃ© puedo hacer aquÃ­?': 'Puedes: 1) Explorar la documentaciÃ³n de cada caso de uso, 2) Entender la arquitectura del sistema, 3) Ver ejemplos de cÃ³digo, 4) Aprender sobre el enfoque de IA, 5) Editar el contenido haciendo clic en "Editar".',
        'MuÃ©strame un ejemplo': 'Por ejemplo, puedes navegar a la secciÃ³n de "PersonalizaciÃ³n" para entender cÃ³mo funciona el motor de recomendaciones, quÃ© datos utiliza y cÃ³mo se procesa la informaciÃ³n.',
        'Â¿CÃ³mo integro esto?': 'Cada caso de uso tiene ejemplos de cÃ³digo en Python, JavaScript y cURL. TambiÃ©n puedes ver la documentaciÃ³n completa de las APIs en la secciÃ³n "API Reference".'
    },
    'default': {
        'Â¿CÃ³mo funciona esta secciÃ³n?': 'Esta secciÃ³n te permite aprovechar las capacidades de IA para mejorar tus operaciones de marketing. Explora las diferentes opciones disponibles en el menÃº lateral.',
        'Â¿QuÃ© puedo hacer aquÃ­?': 'Puedes acceder a mÃºltiples casos de uso de IA: personalizaciÃ³n, predicciÃ³n de churn, optimizaciÃ³n de campaÃ±as, generaciÃ³n de contenido y mÃ¡s.',
        'MuÃ©strame un ejemplo': 'Por ejemplo, puedes usar el motor de recomendaciones para personalizar la experiencia de cada cliente basÃ¡ndote en su comportamiento histÃ³rico.',
        'Â¿CÃ³mo integro esto?': 'Todas las funcionalidades estÃ¡n disponibles mediante APIs REST. Ve a la secciÃ³n "IntegraciÃ³n" para ver ejemplos de cÃ³digo y documentaciÃ³n.'
    }
};

let currentPageFixed = 'default';

function askAssistantFixed(question) {
    sendAssistantFixedMessage(question);
}

function handleAssistantFixedKeyPress(event) {
    if (event.key === 'Enter') {
        sendAssistantFixedMessage();
    }
}

function sendAssistantFixedMessage(predefinedQuestion = null) {
    const input = document.getElementById('assistantFixedInput');
    const question = predefinedQuestion || input.value.trim();
    
    if (!question) return;
    
    // Limpiar input
    if (!predefinedQuestion) {
        input.value = '';
    }
    
    // Agregar mensaje del usuario
    addFixedMessage(question, 'user');
    
    // Simular "escribiendo..."
    setTimeout(() => {
        showFixedTypingIndicator();
        
        // Responder despuÃ©s de un delay
        setTimeout(() => {
            hideFixedTypingIndicator();
            const response = getFixedResponse(question);
            addFixedMessage(response, 'assistant');
        }, 1000 + Math.random() * 1000);
    }, 300);
}

function addFixedMessage(text, type) {
    const chatContainer = document.getElementById('assistantChatContainer');
    const messageDiv = document.createElement('div');
    messageDiv.className = `chat-message ${type === 'user' ? 'user-msg' : 'assistant-msg'}`;
    
    const now = new Date();
    const time = now.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' });
    
    messageDiv.innerHTML = `
        <div class="msg-avatar">${type === 'user' ? 'ðŸ‘¤' : 'ðŸ¤–'}</div>
        <div class="msg-bubble">
            <p>${text}</p>
            <span class="msg-time">${time}</span>
        </div>
    `;
    
    chatContainer.appendChild(messageDiv);
    chatContainer.scrollTop = chatContainer.scrollHeight;
}

function showFixedTypingIndicator() {
    const chatContainer = document.getElementById('assistantChatContainer');
    const typingDiv = document.createElement('div');
    typingDiv.className = 'chat-message assistant-msg';
    typingDiv.id = 'typingIndicatorFixed';
    typingDiv.innerHTML = `
        <div class="msg-avatar">ðŸ¤–</div>
        <div class="msg-bubble">
            <div class="typing-indicator-fixed">
                <div class="typing-dot-fixed"></div>
                <div class="typing-dot-fixed"></div>
                <div class="typing-dot-fixed"></div>
            </div>
        </div>
    `;
    chatContainer.appendChild(typingDiv);
    chatContainer.scrollTop = chatContainer.scrollHeight;
}

function hideFixedTypingIndicator() {
    const indicator = document.getElementById('typingIndicatorFixed');
    if (indicator) {
        indicator.remove();
    }
}

function getFixedResponse(question) {
    const responses = assistantFixedResponses[currentPageFixed] || assistantFixedResponses['default'];
    
    // Buscar respuesta exacta
    if (responses[question]) {
        return responses[question];
    }
    
    // Buscar por palabras clave
    const lowerQuestion = question.toLowerCase();
    
    if (lowerQuestion.includes('funciona') || lowerQuestion.includes('cÃ³mo')) {
        return responses['Â¿CÃ³mo funciona esta secciÃ³n?'];
    }
    if (lowerQuestion.includes('hacer') || lowerQuestion.includes('puedo')) {
        return responses['Â¿QuÃ© puedo hacer aquÃ­?'];
    }
    if (lowerQuestion.includes('ejemplo') || lowerQuestion.includes('muestra')) {
        return responses['MuÃ©strame un ejemplo'];
    }
    if (lowerQuestion.includes('integr') || lowerQuestion.includes('api') || lowerQuestion.includes('conectar')) {
        return responses['Â¿CÃ³mo integro esto?'];
    }
    
    // Respuesta por defecto
    return 'Interesante pregunta. Te recomiendo explorar la documentaciÃ³n en la secciÃ³n "IntroducciÃ³n" o contactar con el equipo de soporte para mÃ¡s detalles especÃ­ficos. Â¿Hay algo mÃ¡s en lo que pueda ayudarte?';
}

// Detectar la pÃ¡gina actual
document.addEventListener('DOMContentLoaded', function() {
    const path = window.location.pathname;
    if (path.includes('dashboard')) currentPageFixed = 'dashboard';
    else if (path.includes('integracion_datos')) currentPageFixed = 'integracion_datos';
    else if (path.includes('integracion_apis')) currentPageFixed = 'integracion_apis';
    else if (path.includes('laboratorio')) currentPageFixed = 'laboratorio';
    else if (path.includes('monitorizacion')) currentPageFixed = 'monitorizacion';
    else if (path.includes('configuracion')) currentPageFixed = 'configuracion';
    else if (path.includes('introduccion')) currentPageFixed = 'introduccion';
});
</script>
