{% extends "base.html" %}

{% block content %}
<div class="documentacion-container">
    <!-- Header -->
    <div class="documentacion-header">
        <div class="header-content">
            <h1>📚 Documentación Técnica</h1>
            <p class="subtitle">Guía completa del enfoque de IA para Marketing en Iberdrola</p>
        </div>
        <div class="header-actions">
            <button class="btn btn-secondary" id="editBtn">
                <span>✏️</span> <span id="editBtnText">Editar</span>
            </button>
            <button class="btn btn-secondary" id="resetBtn" onclick="resetContent()" title="Restaurar contenido original">
                <span>🔄</span> Restaurar
            </button>
            <button class="btn btn-secondary" onclick="descargarPDF()">
                <span>📄</span> Descargar PDF
            </button>
            <button class="btn btn-secondary" onclick="compartir()">
                <span>🔗</span> Compartir
            </button>
            <button class="btn btn-primary" onclick="buscarDoc()">
                <span>🔍</span> Buscar
            </button>
        </div>
    </div>
    
    <!-- Indicador de guardado -->
    <div id="saveIndicator" class="save-indicator-intro">
        <span>💾</span> Guardando cambios...
    </div>

    <!-- Navegación Lateral -->
    <div class="doc-layout">
        <aside class="doc-sidebar">
            <div class="doc-nav">
                <div class="doc-nav-section">
                    <a href="#introduccion" class="doc-nav-link active">
                        <span class="doc-nav-icon">📖</span>
                        Introducción
                    </a>
                    <a href="#enfoque-general" class="doc-nav-link">
                        <span class="doc-nav-icon">🎯</span>
                        Enfoque General de IA
                    </a>
                    <a href="#arquitectura" class="doc-nav-link">
                        <span class="doc-nav-icon">🏗️</span>
                        Arquitectura del Sistema
                    </a>
                </div>

                {% for categoria_doc in casos_uso_docs %}
                <div class="doc-nav-section">
                    <div class="doc-nav-category">{{ categoria_doc.categoria }}</div>
                    {% for caso in categoria_doc.casos %}
                    <a href="#{{ caso.id }}" class="doc-nav-link">
                        <span class="doc-nav-icon">{{ caso.icono }}</span>
                        {{ caso.nombre }}
                    </a>
                    {% endfor %}
                </div>
                {% endfor %}

                <div class="doc-nav-section">
                    <a href="#api-reference" class="doc-nav-link">
                        <span class="doc-nav-icon">🔌</span>
                        API Reference
                    </a>
                    <a href="#best-practices" class="doc-nav-link">
                        <span class="doc-nav-icon">✨</span>
                        Best Practices
                    </a>
                </div>
            </div>
        </aside>

        <!-- Contenido Principal -->
        <main class="doc-content">
            <!-- Introducción -->
            <section id="introduccion" class="doc-section">
                <h1 class="doc-title editable-content" contenteditable="false">Introducción</h1>
                <p class="doc-text editable-content" contenteditable="false">
                    Bienvenido a la documentación técnica de <strong>Iberdrola AI for Marketing</strong>, una plataforma integral que aprovecha 
                    las últimas tecnologías de Inteligencia Artificial para transformar las operaciones de marketing digital.
                </p>
                <p class="doc-text editable-content" contenteditable="false">
                    Esta plataforma integra múltiples capacidades de IA que abarcan desde la personalización de experiencias hasta la 
                    optimización de campañas, pasando por generación de contenido y análisis predictivo de clientes.
                </p>
                
                <div class="doc-info-box">
                    <div class="info-box-header">
                        <span class="info-box-icon">💡</span>
                        <strong>¿Para quién es esta documentación?</strong>
                    </div>
                    <ul class="info-box-list">
                        <li>Equipos de Marketing que quieren entender las capacidades de IA disponibles</li>
                        <li>Data Scientists y ML Engineers que implementan y mantienen los modelos</li>
                        <li>Desarrolladores que integran las APIs en aplicaciones empresariales</li>
                        <li>Product Managers que diseñan nuevas funcionalidades</li>
                    </ul>
                </div>
            </section>

            <!-- Enfoque General de IA -->
            <section id="enfoque-general" class="doc-section">
                <h1 class="doc-title editable-content" contenteditable="false">Enfoque General de IA para Marketing</h1>
                
                <h2 class="doc-subtitle editable-content" contenteditable="false">Filosofía y Principios</h2>
                <p class="doc-text editable-content" contenteditable="false">
                    Nuestro enfoque de IA para marketing se basa en tres pilares fundamentales:
                </p>

                <div class="principios-grid">
                    <div class="principio-card">
                        <div class="principio-icon">🎯</div>
                        <h3 class="editable-content" contenteditable="false">Personalización a Escala</h3>
                        <p class="editable-content" contenteditable="false">Cada cliente recibe experiencias únicas y relevantes, impulsadas por modelos de ML que aprenden continuamente de sus interacciones.</p>
                    </div>
                    <div class="principio-card">
                        <div class="principio-icon">🔄</div>
                        <h3 class="editable-content" contenteditable="false">Optimización Continua</h3>
                        <p class="editable-content" contenteditable="false">Los sistemas de IA ajustan automáticamente las estrategias de marketing en tiempo real basándose en el rendimiento observado.</p>
                    </div>
                    <div class="principio-card">
                        <div class="principio-icon">📊</div>
                        <h3 class="editable-content" contenteditable="false">Decisiones Data-Driven</h3>
                        <p class="editable-content" contenteditable="false">Todas las recomendaciones y acciones están respaldadas por análisis riguroso de datos y modelos predictivos validados.</p>
                    </div>
                </div>

                <h2 class="doc-subtitle editable-content" contenteditable="false">Stack Tecnológico</h2>
                <div class="tech-stack-grid">
                    <div class="tech-category">
                        <h4 class="editable-content" contenteditable="false">Machine Learning</h4>
                        <div class="tech-tags">
                            <span class="tech-tag">scikit-learn</span>
                            <span class="tech-tag">XGBoost</span>
                            <span class="tech-tag">LightGBM</span>
                            <span class="tech-tag">TensorFlow</span>
                            <span class="tech-tag">PyTorch</span>
                        </div>
                    </div>
                    <div class="tech-category">
                        <h4 class="editable-content" contenteditable="false">NLP & GenAI</h4>
                        <div class="tech-tags">
                            <span class="tech-tag">GPT-4</span>
                            <span class="tech-tag">Claude 3</span>
                            <span class="tech-tag">BERT</span>
                            <span class="tech-tag">Sentence Transformers</span>
                            <span class="tech-tag">LangChain</span>
                        </div>
                    </div>
                    <div class="tech-category">
                        <h4 class="editable-content" contenteditable="false">Data Processing</h4>
                        <div class="tech-tags">
                            <span class="tech-tag">Apache Spark</span>
                            <span class="tech-tag">Pandas</span>
                            <span class="tech-tag">NumPy</span>
                            <span class="tech-tag">Dask</span>
                        </div>
                    </div>
                    <div class="tech-category">
                        <h4 class="editable-content" contenteditable="false">MLOps</h4>
                        <div class="tech-tags">
                            <span class="tech-tag">MLflow</span>
                            <span class="tech-tag">Kubeflow</span>
                            <span class="tech-tag">Docker</span>
                            <span class="tech-tag">Kubernetes</span>
                        </div>
                    </div>
                </div>

                <h2 class="doc-subtitle editable-content" contenteditable="false">Pipeline de ML</h2>
                <div class="pipeline-diagram">
                    <div class="pipeline-step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <h4 class="editable-content" contenteditable="false">Ingesta de Datos</h4>
                            <p class="editable-content" contenteditable="false">Recopilación desde múltiples fuentes (CRM, Analytics, IoT)</p>
                        </div>
                    </div>
                    <div class="pipeline-arrow">→</div>
                    <div class="pipeline-step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <h4 class="editable-content" contenteditable="false">Feature Engineering</h4>
                            <p class="editable-content" contenteditable="false">Transformación y creación de variables predictivas</p>
                        </div>
                    </div>
                    <div class="pipeline-arrow">→</div>
                    <div class="pipeline-step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <h4 class="editable-content" contenteditable="false">Entrenamiento</h4>
                            <p class="editable-content" contenteditable="false">Modelos entrenados con validación cruzada</p>
                        </div>
                    </div>
                    <div class="pipeline-arrow">→</div>
                    <div class="pipeline-step">
                        <div class="step-number">4</div>
                        <div class="step-content">
                            <h4 class="editable-content" contenteditable="false">Despliegue</h4>
                            <p class="editable-content" contenteditable="false">APIs REST con baja latencia y alta disponibilidad</p>
                        </div>
                    </div>
                    <div class="pipeline-arrow">→</div>
                    <div class="pipeline-step">
                        <div class="step-number">5</div>
                        <div class="step-content">
                            <h4 class="editable-content" contenteditable="false">Monitorización</h4>
                            <p class="editable-content" contenteditable="false">Tracking de performance y detección de drift</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Arquitectura -->
            <section id="arquitectura" class="doc-section">
                <h1 class="doc-title editable-content" contenteditable="false">Arquitectura del Sistema</h1>
                <p class="doc-text editable-content" contenteditable="false">
                    La plataforma está construida sobre una arquitectura de microservicios que permite escalabilidad, 
                    mantenibilidad y despliegue independiente de cada capacidad de IA.
                </p>

                <div class="architecture-layers">
                    <div class="arch-layer">
                        <div class="layer-header">Capa de Presentación</div>
                        <div class="layer-content">
                            <span class="layer-item">Web UI (React)</span>
                            <span class="layer-item">Mobile Apps</span>
                            <span class="layer-item">Dashboards</span>
                        </div>
                    </div>
                    <div class="arch-layer">
                        <div class="layer-header">Capa de APIs</div>
                        <div class="layer-content">
                            <span class="layer-item">REST APIs</span>
                            <span class="layer-item">GraphQL</span>
                            <span class="layer-item">WebSockets</span>
                        </div>
                    </div>
                    <div class="arch-layer">
                        <div class="layer-header">Capa de Servicios de IA</div>
                        <div class="layer-content">
                            <span class="layer-item">Personalización</span>
                            <span class="layer-item">Predicción</span>
                            <span class="layer-item">Generación</span>
                            <span class="layer-item">Optimización</span>
                        </div>
                    </div>
                    <div class="arch-layer">
                        <div class="layer-header">Capa de Datos</div>
                        <div class="layer-content">
                            <span class="layer-item">PostgreSQL</span>
                            <span class="layer-item">Redis</span>
                            <span class="layer-item">S3</span>
                            <span class="layer-item">Feature Store</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Casos de Uso -->
            {% for categoria_doc in casos_uso_docs %}
            <section class="doc-section">
                <h1 class="doc-title doc-category-title editable-content" contenteditable="false">{{ categoria_doc.categoria }}</h1>
                
                {% for caso in categoria_doc.casos %}
                <div id="{{ caso.id }}" class="caso-uso-doc">
                    <div class="caso-header">
                        <span class="caso-icon-large">{{ caso.icono }}</span>
                        <div>
                            <h2 class="caso-nombre editable-content" contenteditable="false">{{ caso.nombre }}</h2>
                            <p class="caso-descripcion-doc editable-content" contenteditable="false">{{ caso.descripcion }}</p>
                        </div>
                    </div>

                    <div class="doc-subsection">
                        <h3 class="doc-subsection-title editable-content" contenteditable="false">🧠 Enfoque de IA</h3>
                        <p class="doc-text editable-content" contenteditable="false">{{ caso.enfoque_ia }}</p>
                    </div>

                    <div class="doc-subsection">
                        <h3 class="doc-subsection-title editable-content" contenteditable="false">📥 Datos de Entrada</h3>
                        <p class="doc-text editable-content" contenteditable="false">{{ caso.datos_entrada }}</p>
                    </div>

                    <div class="doc-subsection">
                        <h3 class="doc-subsection-title editable-content" contenteditable="false">⚙️ Procesamiento</h3>
                        <p class="doc-text editable-content" contenteditable="false">{{ caso.procesamiento }}</p>
                    </div>

                    <div class="doc-subsection">
                        <h3 class="doc-subsection-title editable-content" contenteditable="false">📤 Salida</h3>
                        <p class="doc-text editable-content" contenteditable="false">{{ caso.salida }}</p>
                    </div>

                    <div class="doc-subsection">
                        <h3 class="doc-subsection-title editable-content" contenteditable="false">🤖 Modelos y Técnicas</h3>
                        <div class="modelos-list">
                            {% for modelo in caso.modelos %}
                            <span class="modelo-badge">{{ modelo }}</span>
                            {% endfor %}
                        </div>
                    </div>

                    <div class="doc-actions">
                        <a href="{{ url_for(caso.id) }}" class="doc-action-btn">
                            <span>🚀</span> Ver Demo en Vivo
                        </a>
                        <button class="doc-action-btn-secondary" onclick="verCodigoEjemplo('{{ caso.id }}')">
                            <span>💻</span> Código de Ejemplo
                        </button>
                    </div>
                </div>
                {% endfor %}
            </section>
            {% endfor %}

            <!-- API Reference -->
            <section id="api-reference" class="doc-section">
                <h1 class="doc-title editable-content" contenteditable="false">API Reference</h1>
                <p class="doc-text editable-content" contenteditable="false">
                    Todas las capacidades de IA están disponibles a través de APIs REST con autenticación OAuth 2.0.
                </p>

                <div class="api-endpoint-doc">
                    <div class="endpoint-method">POST</div>
                    <div class="endpoint-path">/api/v1/personalization/recommend</div>
                </div>
                <p class="doc-text editable-content" contenteditable="false">Obtiene recomendaciones personalizadas para un usuario.</p>

                <div class="code-example">
                    <div class="code-header">
                        <span>Request Example</span>
                        <button onclick="copiarCodigo('api-example-1')">📋 Copiar</button>
                    </div>
                    <pre id="api-example-1"><code>{
  "user_id": "12345",
  "context": {
    "page": "home",
    "device": "mobile"
  },
  "num_recommendations": 5
}</code></pre>
                </div>

                <div class="doc-info-box" style="margin-top: 20px;">
                    <div class="info-box-header">
                        <span class="info-box-icon">📖</span>
                        <strong>Documentación Completa de APIs</strong>
                    </div>
                    <p class="editable-content" contenteditable="false">Para la documentación completa de todas las APIs, visita la sección <a href="{{ url_for('integracion_apis') }}">APIs & Conectores</a>.</p>
                </div>
            </section>

            <!-- Best Practices -->
            <section id="best-practices" class="doc-section">
                <h1 class="doc-title editable-content" contenteditable="false">Best Practices</h1>
                
                <div class="best-practice-item">
                    <h3 class="editable-content" contenteditable="false">✅ Monitorización Continua</h3>
                    <p class="doc-text editable-content" contenteditable="false">
                        Implementa alertas para detectar degradación del modelo (concept drift) y anomalías en las predicciones.
                        Revisa las métricas de performance semanalmente.
                    </p>
                </div>

                <div class="best-practice-item">
                    <h3 class="editable-content" contenteditable="false">✅ A/B Testing</h3>
                    <p class="doc-text editable-content" contenteditable="false">
                        Siempre valida nuevos modelos o cambios significativos mediante A/B tests antes de desplegar a producción completa.
                        Mantén un grupo de control para medir el impacto real.
                    </p>
                </div>

                <div class="best-practice-item">
                    <h3 class="editable-content" contenteditable="false">✅ Explicabilidad</h3>
                    <p class="doc-text editable-content" contenteditable="false">
                        Utiliza técnicas como SHAP values para entender qué factores influyen en las predicciones.
                        Documenta las decisiones del modelo para cumplir con regulaciones.
                    </p>
                </div>

                <div class="best-practice-item">
                    <h3 class="editable-content" contenteditable="false">✅ Data Quality</h3>
                    <p class="doc-text editable-content" contenteditable="false">
                        La calidad de los modelos depende de la calidad de los datos. Implementa validaciones robustas
                        y procesos de limpieza de datos antes del entrenamiento.
                    </p>
                </div>
            </section>
        </main>
    </div>
</div>

<style>
.documentacion-container {
    padding: 30px;
    max-width: 1800px;
    margin: 0 auto;
}

.documentacion-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
}

.header-content h1 {
    font-size: 32px;
    font-weight: 700;
    color: #1a1a1a;
    margin: 0 0 8px 0;
}

.header-actions {
    display: flex;
    gap: 12px;
}

/* Layout */
.doc-layout {
    display: grid;
    grid-template-columns: 280px 1fr;
    gap: 40px;
}

/* Sidebar */
.doc-sidebar {
    position: sticky;
    top: 20px;
    height: fit-content;
    max-height: calc(100vh - 100px);
    overflow-y: auto;
}

.doc-nav {
    background: white;
    border-radius: 12px;
    border: 2px solid #f0f0f0;
    padding: 16px;
}

.doc-nav-section {
    margin-bottom: 20px;
}

.doc-nav-category {
    font-size: 11px;
    font-weight: 700;
    text-transform: uppercase;
    color: #999;
    margin-bottom: 8px;
    padding: 0 12px;
}

.doc-nav-link {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 12px;
    border-radius: 8px;
    text-decoration: none;
    color: #666;
    font-size: 14px;
    font-weight: 600;
    transition: all 0.2s ease;
    margin-bottom: 4px;
}

.doc-nav-link:hover {
    background: #f8f9fa;
    color: #667eea;
}

.doc-nav-link.active {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
}

.doc-nav-icon {
    font-size: 18px;
}

/* Contenido */
.doc-content {
    background: white;
    border-radius: 12px;
    border: 2px solid #f0f0f0;
    padding: 40px;
}

.doc-section {
    margin-bottom: 60px;
}

.doc-title {
    font-size: 36px;
    font-weight: 700;
    color: #1a1a1a;
    margin-bottom: 20px;
    padding-bottom: 12px;
    border-bottom: 3px solid #667eea;
}

.doc-category-title {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.doc-subtitle {
    font-size: 24px;
    font-weight: 700;
    color: #1a1a1a;
    margin: 30px 0 16px 0;
}

.doc-text {
    font-size: 16px;
    line-height: 1.8;
    color: #424242;
    margin-bottom: 16px;
}

/* Info Box */
.doc-info-box {
    background: #e3f2fd;
    border-left: 4px solid #1976d2;
    border-radius: 8px;
    padding: 20px;
    margin: 24px 0;
}

.info-box-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 12px;
    font-size: 16px;
    color: #1976d2;
}

.info-box-icon {
    font-size: 24px;
}

.info-box-list {
    margin: 0;
    padding-left: 20px;
}

.info-box-list li {
    margin-bottom: 8px;
    color: #424242;
}

/* Principios Grid */
.principios-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px;
    margin: 24px 0;
}

.principio-card {
    background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
    border: 2px solid #f0f0f0;
    border-radius: 12px;
    padding: 24px;
    text-align: center;
    transition: all 0.3s ease;
}

.principio-card:hover {
    border-color: #667eea;
    box-shadow: 0 8px 24px rgba(102, 126, 234, 0.15);
    transform: translateY(-4px);
}

.principio-icon {
    font-size: 48px;
    margin-bottom: 16px;
}

.principio-card h3 {
    font-size: 18px;
    font-weight: 700;
    color: #1a1a1a;
    margin-bottom: 12px;
}

.principio-card p {
    font-size: 14px;
    color: #666;
    line-height: 1.6;
}

/* Tech Stack */
.tech-stack-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin: 24px 0;
}

.tech-category h4 {
    font-size: 14px;
    font-weight: 700;
    color: #1a1a1a;
    margin-bottom: 12px;
}

.tech-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}

.tech-tag {
    padding: 6px 12px;
    background: #f8f9fa;
    border: 1px solid #e0e0e0;
    border-radius: 6px;
    font-size: 12px;
    font-weight: 600;
    color: #667eea;
}

/* Pipeline */
.pipeline-diagram {
    display: flex;
    align-items: center;
    gap: 12px;
    margin: 30px 0;
    overflow-x: auto;
    padding: 20px 0;
}

.pipeline-step {
    flex-shrink: 0;
    width: 180px;
    background: white;
    border: 2px solid #f0f0f0;
    border-radius: 12px;
    padding: 16px;
    text-align: center;
}

.step-number {
    width: 32px;
    height: 32px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    margin: 0 auto 12px;
}

.step-content h4 {
    font-size: 14px;
    font-weight: 700;
    color: #1a1a1a;
    margin-bottom: 8px;
}

.step-content p {
    font-size: 12px;
    color: #666;
    line-height: 1.4;
}

.pipeline-arrow {
    font-size: 24px;
    color: #667eea;
    flex-shrink: 0;
}

/* Architecture */
.architecture-layers {
    display: flex;
    flex-direction: column;
    gap: 16px;
    margin: 24px 0;
}

.arch-layer {
    background: white;
    border: 2px solid #f0f0f0;
    border-radius: 12px;
    overflow: hidden;
}

.layer-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 12px 20px;
    font-weight: 700;
    font-size: 14px;
}

.layer-content {
    padding: 16px 20px;
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
}

.layer-item {
    padding: 6px 12px;
    background: #f8f9fa;
    border-radius: 6px;
    font-size: 13px;
    font-weight: 600;
    color: #424242;
}

/* Caso de Uso Doc */
.caso-uso-doc {
    background: #f8f9fa;
    border-radius: 12px;
    padding: 30px;
    margin-bottom: 40px;
    border: 2px solid #f0f0f0;
}

.caso-header {
    display: flex;
    align-items: center;
    gap: 20px;
    margin-bottom: 30px;
    padding-bottom: 20px;
    border-bottom: 2px solid #e0e0e0;
}

.caso-icon-large {
    font-size: 48px;
}

.caso-nombre {
    font-size: 28px;
    font-weight: 700;
    color: #1a1a1a;
    margin: 0 0 8px 0;
}

.caso-descripcion-doc {
    font-size: 16px;
    color: #666;
    margin: 0;
}

.doc-subsection {
    margin-bottom: 24px;
}

.doc-subsection-title {
    font-size: 18px;
    font-weight: 700;
    color: #1a1a1a;
    margin-bottom: 12px;
}

.modelos-list {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}

.modelo-badge {
    padding: 8px 14px;
    background: white;
    border: 2px solid #667eea;
    border-radius: 8px;
    font-size: 13px;
    font-weight: 600;
    color: #667eea;
}

.doc-actions {
    display: flex;
    gap: 12px;
    margin-top: 24px;
    padding-top: 24px;
    border-top: 2px solid #e0e0e0;
}

.doc-action-btn {
    padding: 12px 24px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 600;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
}

.doc-action-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
}

.doc-action-btn-secondary {
    padding: 12px 24px;
    background: white;
    color: #667eea;
    border: 2px solid #667eea;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 600;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
}

.doc-action-btn-secondary:hover {
    background: #667eea;
    color: white;
}

/* API Endpoint */
.api-endpoint-doc {
    display: flex;
    align-items: center;
    gap: 12px;
    margin: 20px 0;
    padding: 16px;
    background: #f8f9fa;
    border-radius: 8px;
    border-left: 4px solid #667eea;
}

.endpoint-method {
    padding: 6px 12px;
    background: #667eea;
    color: white;
    border-radius: 6px;
    font-size: 12px;
    font-weight: 700;
}

.endpoint-path {
    font-family: 'Courier New', monospace;
    font-size: 14px;
    font-weight: 600;
    color: #1a1a1a;
}

/* Code Example */
.code-example {
    margin: 20px 0;
    border-radius: 8px;
    overflow: hidden;
    border: 2px solid #f0f0f0;
}

.code-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 16px;
    background: #1e1e1e;
    color: white;
    font-size: 13px;
    font-weight: 600;
}

.code-header button {
    padding: 4px 10px;
    background: #667eea;
    color: white;
    border: none;
    border-radius: 4px;
    font-size: 12px;
    cursor: pointer;
}

.code-example pre {
    margin: 0;
    padding: 16px;
    background: #1e1e1e;
    overflow-x: auto;
}

.code-example code {
    font-family: 'Courier New', monospace;
    font-size: 13px;
    line-height: 1.6;
    color: #d4d4d4;
}

/* Best Practices */
.best-practice-item {
    margin-bottom: 24px;
    padding: 20px;
    background: #f8f9fa;
    border-radius: 8px;
    border-left: 4px solid #4caf50;
}

.best-practice-item h3 {
    font-size: 18px;
    font-weight: 700;
    color: #1a1a1a;
    margin-bottom: 12px;
}

/* Responsive */
@media (max-width: 1200px) {
    .doc-layout {
        grid-template-columns: 1fr;
    }
    
    .doc-sidebar {
        position: static;
        max-height: none;
    }
}
</style>

<script>
// Smooth scroll para navegación
document.querySelectorAll('.doc-nav-link').forEach(link => {
    link.addEventListener('click', function(e) {
        e.preventDefault();
        const targetId = this.getAttribute('href').substring(1);
        const targetElement = document.getElementById(targetId);
        
        if (targetElement) {
            targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
            
            // Update active link
            document.querySelectorAll('.doc-nav-link').forEach(l => l.classList.remove('active'));
            this.classList.add('active');
        }
    });
});

function descargarPDF() {
    alert('📄 Generando PDF de la documentación...\n\nTamaño estimado: 5.2 MB\nPáginas: 47\n\nDescarga iniciada.');
}

function compartir() {
    alert('🔗 Enlace copiado al portapapeles:\n\nhttps://iberdrola-ai.com/docs/v1\n\nComparte esta documentación con tu equipo.');
}

function buscarDoc() {
    const termino = prompt('🔍 Buscar en la documentación:');
    if (termino) {
        alert(`Buscando: "${termino}"\n\nSe encontraron 12 resultados.`);
    }
}

function verCodigoEjemplo(casoId) {
    alert(`💻 Código de Ejemplo: ${casoId}\n\nAbriendo ejemplos de integración en Python, JavaScript y cURL...`);
}

function copiarCodigo(id) {
    const code = document.getElementById(id).textContent;
    navigator.clipboard.writeText(code);
    alert('✅ Código copiado al portapapeles!');
}

// ==================== MODO EDICIÓN ====================
console.log('Script de edición cargado');
var editMode = false;
var originalContent = {};

// Cargar contenido guardado al inicio
function loadSavedContent() {
    const savedContent = localStorage.getItem('introduccion_content');
    if (savedContent) {
        try {
            const content = JSON.parse(savedContent);
            console.log('Cargando contenido guardado:', Object.keys(content).length, 'elementos');
            
            Object.keys(content).forEach(index => {
                const elements = document.querySelectorAll('.editable-content');
                if (elements[index]) {
                    elements[index].innerHTML = content[index];
                }
            });
        } catch (e) {
            console.error('Error al cargar contenido guardado:', e);
        }
    }
}

// Guardar contenido en localStorage
function saveContentToStorage(elements) {
    const content = {};
    elements.forEach((el, index) => {
        content[index] = el.innerHTML;
    });
    localStorage.setItem('introduccion_content', JSON.stringify(content));
    console.log('Contenido guardado en localStorage');
}

// Resetear contenido al original
function resetContent() {
    if (confirm('¿Estás seguro de que quieres restaurar el contenido original?\n\nEsto eliminará todos los cambios que hayas hecho.')) {
        localStorage.removeItem('introduccion_content');
        location.reload();
    }
}

function toggleEditMode() {
    console.log('=== INICIO toggleEditMode ===');
    console.log('editMode actual:', editMode);
    
    editMode = !editMode;
    console.log('editMode después de toggle:', editMode);
    
    const editBtn = document.getElementById('editBtn');
    const editBtnText = document.getElementById('editBtnText');
    const editableElements = document.querySelectorAll('.editable-content');
    
    console.log('Botón encontrado:', editBtn);
    console.log('Texto del botón encontrado:', editBtnText);
    console.log('Elementos editables encontrados:', editableElements.length);
    
    if (!editBtn || !editBtnText) {
        console.error('ERROR: No se encontraron los elementos del botón');
        alert('Error: No se encontró el botón de edición');
        return;
    }
    
    if (editableElements.length === 0) {
        console.error('ERROR: No se encontraron elementos editables');
        alert('Error: No se encontraron elementos editables');
        return;
    }
    
    console.log('Entrando en if editMode:', editMode);
    
    if (editMode) {
        console.log('ACTIVANDO MODO EDICIÓN');
        // Activar modo edición
        editBtn.classList.add('active');
        editBtn.style.background = '#4caf50';
        editBtnText.textContent = 'Guardar';
        
        console.log('Procesando', editableElements.length, 'elementos...');
        editableElements.forEach((el, index) => {
            // Guardar contenido original
            originalContent[index] = el.innerHTML;
            
            // Hacer editable
            el.contentEditable = 'true';
            el.style.outline = '2px dashed #667eea';
            el.style.outlineOffset = '4px';
            el.style.padding = '8px';
            el.style.borderRadius = '4px';
            el.style.background = 'rgba(102, 126, 234, 0.05)';
            el.style.cursor = 'text';
            
            // Agregar evento de cambio
            el.addEventListener('input', handleContentChange);
        });
        
        console.log('Elementos procesados. Mostrando alerta...');
        alert('✏️ Modo edición activado\n\nPuedes editar cualquier texto en la página.\nHaz clic en "Guardar" cuando termines.');
        console.log('=== FIN ACTIVACIÓN ===');
    } else {
        // Guardar cambios
        saveAllChanges(editableElements);
        
        // Desactivar modo edición
        editBtn.classList.remove('active');
        editBtn.style.background = '';
        editBtnText.textContent = 'Editar';
        
        editableElements.forEach(el => {
            el.contentEditable = 'false';
            el.style.outline = '';
            el.style.outlineOffset = '';
            el.style.padding = '';
            el.style.borderRadius = '';
            el.style.background = '';
            el.style.cursor = '';
            
            el.removeEventListener('input', handleContentChange);
        });
        console.log('=== FIN DESACTIVACIÓN ===');
    }
    
    console.log('=== FIN toggleEditMode ===');
}

// Verificar que el DOM esté listo
document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM listo');
    
    // Cargar contenido guardado
    loadSavedContent();
    
    const editBtn = document.getElementById('editBtn');
    console.log('Botón de edición en DOM:', editBtn);
    
    // Agregar event listener al botón
    if (editBtn) {
        console.log('Agregando event listener al botón');
        editBtn.addEventListener('click', function(e) {
            e.preventDefault();
            console.log('Click detectado en botón de edición');
            console.log('Tipo de toggleEditMode:', typeof toggleEditMode);
            console.log('toggleEditMode es:', toggleEditMode);
            console.log('Llamando a toggleEditMode...');
            
            // Llamar directamente
            console.log('=== INICIO MANUAL ===');
            editMode = !editMode;
            console.log('editMode cambiado a:', editMode);
            
            const editBtnLocal = document.getElementById('editBtn');
            const editBtnTextLocal = document.getElementById('editBtnText');
            const editableElementsLocal = document.querySelectorAll('.editable-content');
            
            console.log('Elementos encontrados:', editableElementsLocal.length);
            
            if (editMode) {
                console.log('Activando edición...');
                editBtnLocal.style.background = '#4caf50';
                editBtnTextLocal.textContent = 'Guardar';
                
                editableElementsLocal.forEach((el, index) => {
                    el.contentEditable = 'true';
                    el.style.outline = '2px dashed #667eea';
                    el.style.outlineOffset = '4px';
                    el.style.padding = '8px';
                    el.style.background = 'rgba(102, 126, 234, 0.05)';
                });
                
                alert('✏️ Modo edición activado!');
            } else {
                console.log('Desactivando edición...');
                
                // Guardar cambios en localStorage
                saveContentToStorage(editableElementsLocal);
                
                // Mostrar indicador de guardado
                const saveIndicator = document.getElementById('saveIndicator');
                if (saveIndicator) {
                    saveIndicator.style.display = 'flex';
                    setTimeout(() => {
                        saveIndicator.style.display = 'none';
                    }, 2000);
                }
                
                editBtnLocal.style.background = '';
                editBtnTextLocal.textContent = 'Editar';
                
                editableElementsLocal.forEach(el => {
                    el.contentEditable = 'false';
                    el.style.outline = '';
                    el.style.outlineOffset = '';
                    el.style.padding = '';
                    el.style.background = '';
                });
                
                alert('💾 Cambios guardados!\n\nLos cambios se mantendrán incluso si refrescas la página.');
            }
        });
    } else {
        console.error('No se encontró el botón editBtn');
    }
});

function handleContentChange(e) {
    // Mostrar indicador de cambios sin guardar
    console.log('Contenido modificado:', e.target);
}

function saveAllChanges(elements) {
    const changes = [];
    
    elements.forEach((el, index) => {
        if (el.innerHTML !== originalContent[index]) {
            changes.push({
                index: index,
                oldContent: originalContent[index],
                newContent: el.innerHTML,
                element: el.tagName
            });
        }
    });
    
    if (changes.length > 0) {
        // Mostrar indicador de guardado
        const saveIndicator = document.getElementById('saveIndicator');
        saveIndicator.style.display = 'flex';
        
        // Simular guardado (aquí podrías hacer una llamada AJAX para guardar en el servidor)
        setTimeout(() => {
            saveIndicator.style.display = 'none';
            alert(`💾 Cambios guardados correctamente!\n\n${changes.length} elemento(s) modificado(s).`);
            
            // Limpiar contenido original
            originalContent = {};
        }, 1000);
        
        console.log('Cambios guardados:', changes);
    } else {
        alert('ℹ️ No hay cambios para guardar.');
    }
}

// Atajos de teclado
document.addEventListener('keydown', function(e) {
    // Ctrl/Cmd + E para toggle edit mode
    if ((e.ctrlKey || e.metaKey) && e.key === 'e') {
        e.preventDefault();
        toggleEditMode();
    }
    
    // Ctrl/Cmd + S para guardar (si está en modo edición)
    if ((e.ctrlKey || e.metaKey) && e.key === 's' && editMode) {
        e.preventDefault();
        toggleEditMode(); // Esto guardará los cambios
    }
});
</script>

<!-- Incluir Asistente Virtual Fijo -->
{% include 'asistente_panel_fijo.html' %}

{% endblock %}
