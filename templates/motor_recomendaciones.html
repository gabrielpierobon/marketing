{% extends "base.html" %}

{% block title %}Motor de Recomendaciones - Iberdrola AI{% endblock %}

{% block page_title %}Motor de Recomendaciones IA{% endblock %}

{% block content %}
<!-- Documentation Panel Toggle -->
<button class="doc-panel-toggle" aria-label="Ocultar documentaci√≥n">
    <span class="icon">üìö</span>
    <span>Ocultar Panel</span>
</button>

<!-- Documentation Panel -->
<div class="doc-panel">
    <div class="doc-panel-header">
        <div class="doc-panel-title">
            <h2>üéÅ Motor de Recomendaciones</h2>
            <p>Gu√≠a t√©cnica completa del caso de uso</p>
        </div>
        <div class="doc-panel-header-actions">
            <button class="doc-edit-btn" aria-label="Editar documentaci√≥n">
                <span>‚úèÔ∏è</span> Editar
            </button>
            <button class="doc-panel-close" aria-label="Cerrar">√ó</button>
        </div>
    </div>
    
    <div class="doc-panel-content">
        <!-- Resumen -->
        <div class="doc-section">
            <h3 class="doc-section-title">
                <span class="icon">üìã</span>
                Resumen Ejecutivo
            </h3>
            <div class="doc-section-content">
                <p>
                    El <strong>Motor de Recomendaciones</strong> utiliza algoritmos de filtrado colaborativo y content-based 
                    filtering para predecir qu√© productos o servicios tienen mayor probabilidad de interesar a cada cliente. 
                    Combina Matrix Factorization (SVD) con Deep Learning para capturar patrones complejos en las preferencias.
                </p>
                
                <p>
                    <strong>Datos de Entrada:</strong>
                </p>
                <ul>
                    <li><strong>Matriz Usuario-Producto:</strong> Interacciones hist√≥ricas (vistas, clicks, compras) en formato sparse matrix</li>
                    <li><strong>Features de Usuario:</strong> Edad, ubicaci√≥n, consumo energ√©tico, productos actuales, segmento</li>
                    <li><strong>Features de Producto:</strong> Categor√≠a, precio, caracter√≠sticas t√©cnicas, popularidad</li>
                    <li><strong>Datos Contextuales:</strong> Temporada, d√≠a de la semana, dispositivo, fuente de tr√°fico</li>
                    <li><strong>Se√±ales Impl√≠citas:</strong> Tiempo en p√°gina, scroll depth, b√∫squedas, carritos abandonados</li>
                </ul>
                
                <div class="doc-highlight-box">
                    <strong>üîÑ Pipeline de Recomendaci√≥n</strong><br>
                    Datos hist√≥ricos ‚Üí Feature engineering ‚Üí Entrenamiento de modelos (SVD + Neural CF) ‚Üí 
                    Generaci√≥n de embeddings ‚Üí C√°lculo de similitud ‚Üí Ranking de productos ‚Üí 
                    Aplicaci√≥n de reglas de negocio ‚Üí Top-N recomendaciones por usuario
                </div>
                
                <p>
                    <strong>Output del Sistema:</strong>
                </p>
                <ul>
                    <li><strong>Recomendaciones Personalizadas:</strong> Lista rankeada de productos con scores de afinidad (0-1)</li>
                    <li><strong>Productos Similares:</strong> Items relacionados basados en embeddings de contenido</li>
                    <li><strong>Bundles Sugeridos:</strong> Combinaciones de productos frecuentemente comprados juntos</li>
                    <li><strong>Next Best Action:</strong> Acci√≥n √≥ptima a realizar con cada cliente (oferta, contacto, upgrade)</li>
                </ul>
            </div>
        </div>
        
        <!-- Modelos de IA -->
        <div class="doc-section">
            <h3 class="doc-section-title">
                <span class="icon">ü§ñ</span>
                Modelos de IA Aplicados
            </h3>
            <div class="doc-section-content">
                <div class="doc-model-card">
                    <div class="doc-model-name">
                        üß† Collaborative Filtering
                    </div>
                    <div class="doc-model-desc">
                        <p>
                            Recomendaciones basadas en similitud entre usuarios y productos.
                        </p>
                        <p>
                            <strong>Detalles t√©cnicos:</strong> Este modelo utiliza t√©cnicas avanzadas de machine learning 
                            para procesar grandes vol√∫menes de datos y generar predicciones precisas. El sistema est√° 
                            optimizado para escalar horizontalmente y procesar millones de registros diariamente.
                        </p>
                        <p>
                            <strong>Aplicaci√≥n pr√°ctica:</strong> El modelo se entrena con datos hist√≥ricos y se actualiza 
                            regularmente para mantener su precisi√≥n. Las predicciones se integran en tiempo real con los 
                            sistemas de negocio para automatizar decisiones y acciones.
                        </p>
            </div>
                    <div class="doc-tech-stack">
                        <div class="doc-tech-item">
                            <div class="doc-tech-icon">‚ö°</div>
                            <div class="doc-tech-name">ALS</div>
                        </div>
                        <div class="doc-tech-item">
                            <div class="doc-tech-icon">üìä</div>
                            <div class="doc-tech-name">SVD++</div>
                        </div>
                    </div>
                </div>
                
                <div class="doc-model-card">
                    <div class="doc-model-name">
                        üéØ Content-Based Filtering
                    </div>
                    <div class="doc-model-desc">
                        <p>
                            Recomendaciones basadas en caracter√≠sticas de productos y preferencias.
                        </p>
                        <p>
                            <strong>Detalles t√©cnicos:</strong> Este modelo utiliza t√©cnicas avanzadas de machine learning 
                            para procesar grandes vol√∫menes de datos y generar predicciones precisas. El sistema est√° 
                            optimizado para escalar horizontalmente y procesar millones de registros diariamente.
                        </p>
                        <p>
                            <strong>Aplicaci√≥n pr√°ctica:</strong> El modelo se entrena con datos hist√≥ricos y se actualiza 
                            regularmente para mantener su precisi√≥n. Las predicciones se integran en tiempo real con los 
                            sistemas de negocio para automatizar decisiones y acciones.
                        </p>
            </div>
                    <div class="doc-tech-stack">
                        <div class="doc-tech-item">
                            <div class="doc-tech-icon">üìù</div>
                            <div class="doc-tech-name">TF-IDF</div>
                        </div>
                        <div class="doc-tech-item">
                            <div class="doc-tech-icon">üî∑</div>
                            <div class="doc-tech-name">Embeddings</div>
                        </div>
                    </div>
                </div>
                
                <div class="doc-model-card">
                    <div class="doc-model-name">
                        ü§ñ Deep Learning (Neural CF)
                    </div>
                    <div class="doc-model-desc">
                        <p>
                            Redes neuronales para capturar patrones complejos de preferencias.
                        </p>
                        <p>
                            <strong>Detalles t√©cnicos:</strong> Este modelo utiliza t√©cnicas avanzadas de machine learning 
                            para procesar grandes vol√∫menes de datos y generar predicciones precisas. El sistema est√° 
                            optimizado para escalar horizontalmente y procesar millones de registros diariamente.
                        </p>
                        <p>
                            <strong>Aplicaci√≥n pr√°ctica:</strong> El modelo se entrena con datos hist√≥ricos y se actualiza 
                            regularmente para mantener su precisi√≥n. Las predicciones se integran en tiempo real con los 
                            sistemas de negocio para automatizar decisiones y acciones.
                        </p>
            </div>
                    <div class="doc-tech-stack">
                        <div class="doc-tech-item">
                            <div class="doc-tech-icon">üî∑</div>
                            <div class="doc-tech-name">TensorFlow</div>
                        </div>
                        <div class="doc-tech-item">
                            <div class="doc-tech-icon">üî∂</div>
                            <div class="doc-tech-name">PyTorch</div>
                        </div>
                    </div>
                </div>
                
            </div>
        </div>
        
        <!-- Arquitectura T√©cnica -->
        <div class="doc-section">
            <h3 class="doc-section-title">
                <span class="icon">üèóÔ∏è</span>
                Arquitectura T√©cnica
            </h3>
            <div class="doc-section-content">
                <p>
                    La arquitectura del sistema est√° dise√±ada siguiendo principios de escalabilidad, alta disponibilidad, 
                    y seguridad. Utiliza servicios cloud nativos de Azure para garantizar un rendimiento √≥ptimo y costes 
                    controlados mediante auto-scaling inteligente.
                </p>
                
                <p><strong>Componentes Principales del Stack Tecnol√≥gico:</strong></p>
                <ul><li>Azure Machine Learning para entrenamiento y deployment. Integraci√≥n completa con el ecosistema de datos empresarial, con conectores nativos y APIs REST para interoperabilidad.</li>
<li>Azure Databricks para procesamiento de datos. Integraci√≥n completa con el ecosistema de datos empresarial, con conectores nativos y APIs REST para interoperabilidad.</li>
<li>Azure Synapse Analytics para data warehousing. Integraci√≥n completa con el ecosistema de datos empresarial, con conectores nativos y APIs REST para interoperabilidad.</li>
<li>Power BI para visualizaci√≥n y reporting. Integraci√≥n completa con el ecosistema de datos empresarial, con conectores nativos y APIs REST para interoperabilidad.</li>
<li>Azure DevOps para CI/CD de modelos. Integraci√≥n completa con el ecosistema de datos empresarial, con conectores nativos y APIs REST para interoperabilidad.</li></ul>
                
                <p><strong>Flujo de Datos:</strong></p>
                <ol class="doc-steps">
                    <li>
                        <strong>Ingesta de Datos</strong><br>
                        Recopilaci√≥n de datos desde m√∫ltiples fuentes (CRM, web, transaccional).
                    </li>
                    <li>
                        <strong>Procesamiento y Feature Engineering</strong><br>
                        Limpieza, transformaci√≥n y creaci√≥n de variables predictivas.
                    </li>
                    <li>
                        <strong>Entrenamiento de Modelos</strong><br>
                        Entrenamiento y validaci√≥n de modelos con MLOps.
                    </li>
                    <li>
                        <strong>Deployment y Scoring</strong><br>
                        Despliegue de modelos como APIs REST para inferencia en tiempo real.
                    </li>
                    <li>
                        <strong>Monitorizaci√≥n y Reentrenamiento</strong><br>
                        Seguimiento de performance y reentrenamiento autom√°tico.
                    </li>
                </ol>
            </div>
        </div>
        
        <!-- KPIs -->
        <div class="doc-section">
            <h3 class="doc-section-title">
                <span class="icon">üìä</span>
                KPIs y M√©tricas de √âxito
            </h3>
            <div class="doc-section-content">
                <p><strong>M√©tricas T√©cnicas:</strong></p>
                <ul>
                    <li>Precisi√≥n, Recall, F1-Score del modelo</li>
                    <li>AUC-ROC y AUC-PR para clasificaci√≥n</li>
                    <li>Latencia de inferencia (p50, p95, p99)</li>
                    <li>Cobertura de predicciones</li>
                </ul>
                
                <p><strong>M√©tricas de Negocio:</strong></p>
                <ul>
                    <li>ROI del caso de uso</li>
                    <li>Impacto en KPIs clave de negocio</li>
                    <li>Adopci√≥n por usuarios finales</li>
                    <li>Satisfacci√≥n del cliente</li>
                </ul>
            </div>
        </div>
    </div>
</div>



<div class="use-case-container">
    <div class="use-case-header">
        <div class="use-case-icon">üéÅ</div>
        <div class="use-case-info">
            <h1>Motor de Recomendaciones IA</h1>
            <p>Sistema inteligente que analiza comportamiento, consumo y preferencias para sugerir productos y servicios personalizados a cada cliente.</p>
        </div>
    </div>

    <!-- M√©tricas del Motor -->
    <div class="metrics-grid">
        <div class="metric-card-rec">
            <div class="metric-header">
                <span class="metric-icon-rec">üéØ</span>
                <span class="metric-label-rec">Precisi√≥n</span>
            </div>
            <div class="metric-value-rec">{{ (metricas.precision * 100)|round(1) }}%</div>
            <div class="metric-change-rec positive">+3.2% vs mes anterior</div>
        </div>
        <div class="metric-card-rec">
            <div class="metric-header">
                <span class="metric-icon-rec">üìä</span>
                <span class="metric-label-rec">F1-Score</span>
            </div>
            <div class="metric-value-rec">{{ (metricas.f1_score * 100)|round(1) }}%</div>
            <div class="metric-change-rec positive">+2.8% vs mes anterior</div>
        </div>
        <div class="metric-card-rec">
            <div class="metric-header">
                <span class="metric-icon-rec">‚ö°</span>
                <span class="metric-label-rec">Latencia</span>
            </div>
            <div class="metric-value-rec">{{ metricas.latencia_ms }}ms</div>
            <div class="metric-change-rec positive">-12ms vs mes anterior</div>
        </div>
        <div class="metric-card-rec">
            <div class="metric-header">
                <span class="metric-icon-rec">üí∞</span>
                <span class="metric-label-rec">Revenue Incremental</span>
            </div>
            <div class="metric-value-rec">‚Ç¨{{ (metricas.revenue_incremental / 1000)|round(0)|int }}K</div>
            <div class="metric-change-rec positive">+18% vs mes anterior</div>
        </div>
    </div>

    <!-- Recomendaciones por Cliente -->
    <div class="card">
        <div class="card-header">
            <h2>üë• Recomendaciones Personalizadas por Cliente</h2>
            <span class="badge badge-info">{{ clientes|length }} clientes analizados</span>
        </div>
        <div class="card-body">
            {% for cliente in clientes %}
            <div class="cliente-rec-card">
                <div class="cliente-rec-header">
                    <div class="cliente-rec-info">
                        <div class="cliente-rec-avatar">{{ cliente.nombre[0] }}</div>
                        <div>
                            <h3 class="cliente-rec-nombre">{{ cliente.nombre }}</h3>
                            <div class="cliente-rec-meta">
                                <span class="badge badge-{{ 'primary' if cliente.segmento == 'Premium' else 'secondary' }}">{{ cliente.segmento }}</span>
                                <span class="cliente-rec-id">{{ cliente.id }}</span>
                                <span class="cliente-rec-consumo">‚ö° {{ cliente.consumo_actual }}</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="recomendaciones-list">
                    {% for rec in cliente.recomendaciones %}
                    <div class="recomendacion-item">
                        <div class="recomendacion-header">
                            <div class="recomendacion-info">
                                <h4 class="recomendacion-titulo">{{ rec.producto }}</h4>
                                <span class="recomendacion-tipo">{{ rec.tipo }}</span>
                            </div>
                            <div class="recomendacion-score">
                                <div class="score-circle" style="--score: {{ rec.probabilidad }}">
                                    <svg viewBox="0 0 36 36" class="circular-chart">
                                        <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                                        <path class="circle" stroke-dasharray="{{ rec.probabilidad }}, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                                        <text x="18" y="20.35" class="percentage">{{ rec.probabilidad }}%</text>
                                    </svg>
                                </div>
                            </div>
                        </div>
                        <div class="recomendacion-details">
                            <div class="recomendacion-razon">
                                <span class="icon">üí°</span>
                                <span>{{ rec.razon }}</span>
                            </div>
                            <div class="recomendacion-ahorro">
                                <span class="icon">üí∞</span>
                                <span>Ahorro estimado: <strong>{{ rec.ahorro_estimado }}</strong></span>
                            </div>
                        </div>
                        <div class="recomendacion-actions">
                            <button class="btn btn-sm btn-primary">Enviar Oferta</button>
                            <button class="btn btn-sm btn-secondary">Ver Detalles</button>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Top Productos Recomendados -->
    <div class="card">
        <div class="card-header">
            <h2>üèÜ Top Productos Recomendados</h2>
            <span class="card-subtitle">√öltimos 30 d√≠as</span>
        </div>
        <div class="card-body">
            <div class="top-productos-table">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Ranking</th>
                            <th>Producto</th>
                            <th>Recomendaciones</th>
                            <th>Conversi√≥n</th>
                            <th>Revenue</th>
                            <th>Tendencia</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for producto in top_productos %}
                        <tr>
                            <td>
                                <div class="ranking-badge ranking-{{ loop.index }}">{{ loop.index }}</div>
                            </td>
                            <td>
                                <strong>{{ producto.nombre }}</strong>
                            </td>
                            <td>{{ producto.recomendaciones|format_number }}</td>
                            <td>
                                <div class="conversion-bar">
                                    <div class="conversion-fill" style="width: {{ (producto.conversion * 100)|round(0) }}%"></div>
                                    <span class="conversion-text">{{ (producto.conversion * 100)|round(0) }}%</span>
                                </div>
                            </td>
                            <td><strong>{{ producto.revenue }}</strong></td>
                            <td>
                                <span class="trend-indicator positive">‚Üó +{{ (5 + loop.index * 2) }}%</span>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- M√©tricas T√©cnicas -->
    <div class="card">
        <div class="card-header">
            <h2>üìä M√©tricas T√©cnicas del Motor</h2>
        </div>
        <div class="card-body">
            <div class="tech-metrics-grid">
                <div class="tech-metric">
                    <div class="tech-metric-label">AUC-ROC</div>
                    <div class="tech-metric-value">{{ (metricas.auc_roc * 100)|round(1) }}%</div>
                    <div class="tech-metric-bar">
                        <div class="tech-metric-fill" style="width: {{ (metricas.auc_roc * 100)|round(0) }}%; background: linear-gradient(90deg, #0078D4, #106EBE);"></div>
                    </div>
                </div>
                <div class="tech-metric">
                    <div class="tech-metric-label">Recall</div>
                    <div class="tech-metric-value">{{ (metricas.recall * 100)|round(1) }}%</div>
                    <div class="tech-metric-bar">
                        <div class="tech-metric-fill" style="width: {{ (metricas.recall * 100)|round(0) }}%; background: linear-gradient(90deg, #107C10, #0E700E);"></div>
                    </div>
                </div>
                <div class="tech-metric">
                    <div class="tech-metric-label">Cobertura</div>
                    <div class="tech-metric-value">{{ (metricas.cobertura * 100)|round(1) }}%</div>
                    <div class="tech-metric-bar">
                        <div class="tech-metric-fill" style="width: {{ (metricas.cobertura * 100)|round(0) }}%; background: linear-gradient(90deg, #FFB900, #F7630C);"></div>
                    </div>
                </div>
                <div class="tech-metric">
                    <div class="tech-metric-label">Recomendaciones/D√≠a</div>
                    <div class="tech-metric-value">{{ metricas.recomendaciones_dia|format_number }}</div>
                    <div class="tech-metric-bar">
                        <div class="tech-metric-fill" style="width: 88%; background: linear-gradient(90deg, #D13438, #BC2F32);"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* Estilos espec√≠ficos para Motor de Recomendaciones */
.metrics-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: var(--spacing-l);
    margin-bottom: var(--spacing-xl);
}

.metric-card-rec {
    background: var(--neutral-background-1);
    border-radius: var(--border-radius-large);
    padding: var(--spacing-l);
    border: 1px solid var(--neutral-stroke-1);
    transition: all var(--duration-fast) var(--curve-easy-ease);
}

.metric-card-rec:hover {
    box-shadow: var(--shadow-8);
    transform: translateY(-2px);
}

.metric-header {
    display: flex;
    align-items: center;
    gap: var(--spacing-s);
    margin-bottom: var(--spacing-m);
}

.metric-icon-rec {
    font-size: 24px;
}

.metric-label-rec {
    font-size: var(--font-size-200);
    color: var(--neutral-foreground-3);
    font-weight: var(--font-weight-semibold);
}

.metric-value-rec {
    font-size: var(--font-size-800);
    font-weight: var(--font-weight-bold);
    color: var(--neutral-foreground-1);
    margin-bottom: var(--spacing-xs);
}

.metric-change-rec {
    font-size: var(--font-size-200);
    font-weight: var(--font-weight-semibold);
}

.metric-change-rec.positive {
    color: var(--success);
}

/* Cliente Recomendaciones Card */
.cliente-rec-card {
    background: var(--neutral-background-2);
    border-radius: var(--border-radius-large);
    padding: var(--spacing-l);
    margin-bottom: var(--spacing-l);
    border: 1px solid var(--neutral-stroke-1);
}

.cliente-rec-header {
    margin-bottom: var(--spacing-l);
}

.cliente-rec-info {
    display: flex;
    align-items: center;
    gap: var(--spacing-m);
}

.cliente-rec-avatar {
    width: 56px;
    height: 56px;
    border-radius: 50%;
    background: linear-gradient(135deg, #0078D4, #106EBE);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    font-weight: var(--font-weight-bold);
}

.cliente-rec-nombre {
    font-size: var(--font-size-400);
    font-weight: var(--font-weight-semibold);
    color: var(--neutral-foreground-1);
    margin: 0 0 var(--spacing-xs) 0;
}

.cliente-rec-meta {
    display: flex;
    align-items: center;
    gap: var(--spacing-m);
    font-size: var(--font-size-200);
    color: var(--neutral-foreground-3);
}

.cliente-rec-id, .cliente-rec-consumo {
    font-family: 'Consolas', monospace;
}

/* Recomendaciones */
.recomendaciones-list {
    display: grid;
    gap: var(--spacing-m);
}

.recomendacion-item {
    background: var(--neutral-background-1);
    border-radius: var(--border-radius-medium);
    padding: var(--spacing-l);
    border: 1px solid var(--neutral-stroke-1);
    transition: all var(--duration-fast) var(--curve-easy-ease);
}

.recomendacion-item:hover {
    box-shadow: var(--shadow-4);
    border-color: var(--primary);
}

.recomendacion-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: var(--spacing-m);
}

.recomendacion-titulo {
    font-size: var(--font-size-300);
    font-weight: var(--font-weight-semibold);
    color: var(--neutral-foreground-1);
    margin: 0 0 var(--spacing-xs) 0;
}

.recomendacion-tipo {
    font-size: var(--font-size-200);
    color: var(--neutral-foreground-3);
    background: var(--neutral-background-3);
    padding: 2px 8px;
    border-radius: var(--border-radius-small);
}

.score-circle {
    width: 60px;
    height: 60px;
}

.circular-chart {
    display: block;
    max-width: 100%;
    max-height: 100%;
}

.circle-bg {
    fill: none;
    stroke: var(--neutral-background-4);
    stroke-width: 2.8;
}

.circle {
    fill: none;
    stroke-width: 2.8;
    stroke-linecap: round;
    animation: progress 1s ease-out forwards;
    stroke: var(--primary);
}

.percentage {
    fill: var(--neutral-foreground-1);
    font-family: var(--font-family-base);
    font-size: 0.5em;
    font-weight: var(--font-weight-bold);
    text-anchor: middle;
}

@keyframes progress {
    0% {
        stroke-dasharray: 0 100;
    }
}

.recomendacion-details {
    display: grid;
    gap: var(--spacing-s);
    margin-bottom: var(--spacing-m);
    padding: var(--spacing-m);
    background: var(--neutral-background-2);
    border-radius: var(--border-radius-small);
}

.recomendacion-razon, .recomendacion-ahorro {
    display: flex;
    align-items: center;
    gap: var(--spacing-s);
    font-size: var(--font-size-200);
    color: var(--neutral-foreground-2);
}

.recomendacion-actions {
    display: flex;
    gap: var(--spacing-s);
}

.btn-sm {
    padding: 6px 12px;
    font-size: var(--font-size-200);
}

/* Tabla de productos */
.top-productos-table {
    overflow-x: auto;
}

.data-table {
    width: 100%;
    border-collapse: collapse;
}

.data-table th {
    text-align: left;
    padding: var(--spacing-m);
    background: var(--neutral-background-2);
    font-weight: var(--font-weight-semibold);
    color: var(--neutral-foreground-2);
    font-size: var(--font-size-200);
    border-bottom: 2px solid var(--neutral-stroke-1);
}

.data-table td {
    padding: var(--spacing-m);
    border-bottom: 1px solid var(--neutral-stroke-1);
}

.ranking-badge {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: var(--font-weight-bold);
    color: white;
}

.ranking-1 { background: linear-gradient(135deg, #FFB900, #F7630C); }
.ranking-2 { background: linear-gradient(135deg, #C0C0C0, #A8A8A8); }
.ranking-3 { background: linear-gradient(135deg, #CD7F32, #B8860B); }
.ranking-4, .ranking-5 { background: linear-gradient(135deg, #0078D4, #106EBE); }

.conversion-bar {
    position: relative;
    width: 100px;
    height: 24px;
    background: var(--neutral-background-3);
    border-radius: var(--border-radius-small);
    overflow: hidden;
}

.conversion-fill {
    position: absolute;
    height: 100%;
    background: linear-gradient(90deg, #107C10, #0E700E);
    transition: width var(--duration-slow) var(--curve-decelerate-max);
}

.conversion-text {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100%;
    font-size: var(--font-size-200);
    font-weight: var(--font-weight-semibold);
    color: var(--neutral-foreground-1);
}

.trend-indicator {
    font-weight: var(--font-weight-semibold);
    font-size: var(--font-size-200);
}

.trend-indicator.positive {
    color: var(--success);
}

/* M√©tricas t√©cnicas */
.tech-metrics-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var(--spacing-l);
}

.tech-metric {
    padding: var(--spacing-m);
}

.tech-metric-label {
    font-size: var(--font-size-200);
    color: var(--neutral-foreground-3);
    margin-bottom: var(--spacing-xs);
}

.tech-metric-value {
    font-size: var(--font-size-600);
    font-weight: var(--font-weight-bold);
    color: var(--neutral-foreground-1);
    margin-bottom: var(--spacing-s);
}

.tech-metric-bar {
    height: 8px;
    background: var(--neutral-background-4);
    border-radius: 4px;
    overflow: hidden;
}

.tech-metric-fill {
    height: 100%;
    border-radius: 4px;
    transition: width var(--duration-slow) var(--curve-decelerate-max);
}
</style>
{% endblock %}
