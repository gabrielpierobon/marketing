{% extends "base.html" %}

{% block title %}Chatbot IA Conversacional - Iberdrola AI{% endblock %}

{% block page_title %}Chatbot IA Conversacional 24/7{% endblock %}

{% block content %}
<!-- Documentation Panel Toggle -->
<button class="doc-panel-toggle" aria-label="Ocultar documentaci√≥n">
    <span class="icon">üìö</span>
    <span>Ocultar Panel</span>
</button>

<!-- Documentation Panel -->
<div class="doc-panel">
    <div class="doc-panel-header">
        <div class="doc-panel-title">
            <h2>üí¨ Chatbot Inteligente con IA</h2>
            <p>Gu√≠a t√©cnica completa del caso de uso</p>
        </div>
        <div class="doc-panel-header-actions">
            <button class="doc-edit-btn" aria-label="Editar documentaci√≥n">
                <span>‚úèÔ∏è</span> Editar
            </button>
            <button class="doc-panel-close" aria-label="Cerrar">√ó</button>
        </div>
    </div>
    
    <div class="doc-panel-content">
        <!-- Resumen -->
        <div class="doc-section">
            <h3 class="doc-section-title">
                <span class="icon">üìã</span>
                Resumen Ejecutivo
            </h3>
            <div class="doc-section-content">
                <p>
                    El <strong>Chatbot Conversacional con IA</strong> utiliza Large Language Models (LLMs) como GPT-4 
                    o Claude combinados con Retrieval Augmented Generation (RAG) para generar respuestas contextuales 
                    y precisas. El sistema procesa lenguaje natural, identifica intenciones, extrae entidades, y genera 
                    respuestas coherentes manteniendo el contexto de la conversaci√≥n.
                </p>
                
                <p>
                    <strong>Datos de Entrada Procesados:</strong>
                </p>
                <ul>
                    <li><strong>Texto del Usuario:</strong> Mensaje en lenguaje natural, tokenizado y vectorizado</li>
                    <li><strong>Historial de Conversaci√≥n:</strong> √öltimos N turnos (t√≠picamente 10-20) para mantener contexto</li>
                    <li><strong>Perfil del Cliente:</strong> ID, segmento, productos contratados, historial de interacciones</li>
                    <li><strong>Base de Conocimiento:</strong> Documentaci√≥n, FAQs, pol√≠ticas, procedimientos (embeddings en vector DB)</li>
                    <li><strong>Datos en Tiempo Real:</strong> Estado de cuenta, facturas, consumo actual, tickets abiertos</li>
                </ul>
                
                <div class="doc-highlight-box">
                    <strong>üîÑ Flujo de Procesamiento</strong><br>
                    Input del usuario ‚Üí Clasificaci√≥n de intenci√≥n (NLU) ‚Üí Extracci√≥n de entidades (NER) ‚Üí 
                    B√∫squeda sem√°ntica en knowledge base (RAG) ‚Üí Generaci√≥n de respuesta (LLM) ‚Üí 
                    Post-procesamiento y validaci√≥n ‚Üí Output al usuario
                </div>
                
                <p>
                    <strong>Capacidades Avanzadas del Chatbot:</strong>
                </p>
                <ul>
                    <li><strong>Comprensi√≥n Contextual:</strong> El chatbot mantiene el contexto de la conversaci√≥n 
                    a lo largo de m√∫ltiples turnos, entendiendo referencias anaf√≥ricas ("eso", "lo anterior", "mi factura") 
                    y manteniendo coherencia en la conversaci√≥n. Memoria de sesi√≥n de hasta 50 turnos.</li>
                    
                    <li><strong>Gesti√≥n de Consultas Complejas:</strong> Puede resolver consultas que requieren 
                    m√∫ltiples pasos, como cambios de tarifa (verificaci√≥n de elegibilidad, c√°lculo de ahorro, 
                    gesti√≥n de penalizaciones), gesti√≥n de aver√≠as (diagn√≥stico, creaci√≥n de ticket, seguimiento), 
                    o consultas de facturaci√≥n detalladas (desglose de conceptos, comparaci√≥n con periodos anteriores).</li>
                    
                    <li><strong>Personalizaci√≥n Din√°mica:</strong> Accede al perfil completo del cliente en tiempo real 
                    (CRM, facturaci√≥n, consumo, interacciones previas) para proporcionar respuestas personalizadas. 
                    Ejemplo: "Hola Juan, veo que tu √∫ltima factura fue de ‚Ç¨87.34 el 15 de marzo. ¬øEn qu√© puedo ayudarte?"</li>
                    
                    <li><strong>Detecci√≥n de Emociones:</strong> Utiliza an√°lisis de sentimiento en tiempo real para 
                    detectar frustraci√≥n, urgencia, o satisfacci√≥n, ajustando su tono y priorizando escalaciones cuando 
                    es necesario. Score de sentimiento < -0.5 ‚Üí escalado autom√°tico a agente humano.</li>
                    
                    <li><strong>Aprendizaje Continuo:</strong> El sistema se entrena continuamente con nuevas 
                    conversaciones, mejorando su precisi√≥n y cobertura con el tiempo. Revisi√≥n semanal de conversaciones 
                    no resueltas para identificar gaps de conocimiento. Fine-tuning mensual del modelo.</li>
                    
                    <li><strong>Multicanal:</strong> Mismo motor conversacional desplegado en web, app m√≥vil, 
                    WhatsApp, Facebook Messenger, Telegram, y otros canales. Experiencia consistente y sincronizada 
                    entre canales (puedes empezar en web y continuar en WhatsApp).</li>
                    
                    <li><strong>Proactividad:</strong> No solo responde preguntas, sino que anticipa necesidades. 
                    Ejemplo: "Veo que tu consumo este mes va un 25% por encima de lo normal. ¬øQuieres que te ayude 
                    a identificar posibles causas?"</li>
                </ul>
                
                <div class="doc-metric-grid">
                    <div class="doc-metric">
                        <div class="doc-metric-value">-60%</div>
                        <div class="doc-metric-label">Costes Operativos</div>
                    </div>
                    <div class="doc-metric">
                        <div class="doc-metric-value">78%</div>
                        <div class="doc-metric-label">Tasa de Resoluci√≥n</div>
                    </div>
                    <div class="doc-metric">
                        <div class="doc-metric-value">24/7</div>
                        <div class="doc-metric-label">Disponibilidad</div>
                    </div>
                    <div class="doc-metric">
                        <div class="doc-metric-value">‚Ç¨100K</div>
                        <div class="doc-metric-label">Inversi√≥n Inicial</div>
                    </div>
                </div>
                
                <p>
                    <strong>Impacto en el Negocio:</strong><br>
                    Las empresas que han implementado chatbots conversacionales avanzados reportan reducciones de 
                    costes de atenci√≥n al cliente de ‚Ç¨300K-800K anuales (reducci√≥n de FTEs necesarios, menor volumen 
                    de llamadas, menor tiempo medio de resoluci√≥n), con mejoras en CSAT (Customer Satisfaction Score) 
                    de 15-25 puntos. El tiempo medio de resoluci√≥n se reduce de 8-15 minutos (agente humano) a 
                    30-90 segundos (chatbot), y la capacidad de atender consultas simult√°neas es pr√°cticamente ilimitada 
                    (vs. 1-2 chats por agente humano).
                </p>
                
                <p>
                    <strong>Ventajas vs. Chatbots Tradicionales:</strong><br>
                    A diferencia de chatbots basados en reglas o √°rboles de decisi√≥n, este sistema utiliza LLMs que 
                    comprenden lenguaje natural de forma flexible. No requiere mapear todas las posibles variaciones 
                    de una pregunta (intent matching perfecto), sino que entiende la intenci√≥n subyacente. Capacidad 
                    de manejar preguntas fuera de script, multi-intent, y conversaciones no lineales. Tasa de 
                    comprensi√≥n: 94% vs. 65% en chatbots tradicionales.
                </p>
            </div>
        </div>
        
        <!-- Modelos de IA -->
        <div class="doc-section">
            <h3 class="doc-section-title">
                <span class="icon">ü§ñ</span>
                Modelos de IA Aplicados
            </h3>
            <div class="doc-section-content">
                <div class="doc-model-card">
                    <div class="doc-model-name">
                        ü¶ú GPT-4 / Claude 3
                    </div>
                    <div class="doc-model-desc">
                        LLM para comprensi√≥n y generaci√≥n de respuestas naturales y contextuales.
                    </div>
                    <div class="doc-tech-stack">
                        <div class="doc-tech-item">
                            <div class="doc-tech-icon">üî∑</div>
                            <div class="doc-tech-name">OpenAI API</div>
                        </div>
                        <div class="doc-tech-item">
                            <div class="doc-tech-icon">üî∂</div>
                            <div class="doc-tech-name">Anthropic</div>
                        </div>
                    </div>
                </div>
                
                <div class="doc-model-card">
                    <div class="doc-model-name">
                        üîç Embeddings + Semantic Search
                    </div>
                    <div class="doc-model-desc">
                        B√∫squeda sem√°ntica en base de conocimiento para respuestas precisas.
                    </div>
                    <div class="doc-tech-stack">
                        <div class="doc-tech-item">
                            <div class="doc-tech-icon">üîé</div>
                            <div class="doc-tech-name">Azure AI Search</div>
                        </div>
                        <div class="doc-tech-item">
                            <div class="doc-tech-icon">üìö</div>
                            <div class="doc-tech-name">Vector DB</div>
                        </div>
                    </div>
                </div>
                
                <div class="doc-model-card">
                    <div class="doc-model-name">
                        üéØ Intent Classification
                    </div>
                    <div class="doc-model-desc">
                        Clasificaci√≥n de intenciones del usuario para routing inteligente.
                    </div>
                    <div class="doc-tech-stack">
                        <div class="doc-tech-item">
                            <div class="doc-tech-icon">ü§ó</div>
                            <div class="doc-tech-name">BERT</div>
                        </div>
                        <div class="doc-tech-item">
                            <div class="doc-tech-icon">‚öôÔ∏è</div>
                            <div class="doc-tech-name">Custom Models</div>
                        </div>
                    </div>
                </div>
                
            </div>
        </div>
        
        <!-- Arquitectura T√©cnica -->
        <div class="doc-section">
            <h3 class="doc-section-title">
                <span class="icon">üèóÔ∏è</span>
                Arquitectura T√©cnica
            </h3>
            <div class="doc-section-content">
                <p><strong>Stack Tecnol√≥gico:</strong></p>
                <ul>
                    <li>Azure Machine Learning para entrenamiento y deployment</li>
                    <li>Azure Databricks para procesamiento de datos</li>
                    <li>Azure Synapse Analytics para data warehousing</li>
                    <li>Power BI para visualizaci√≥n y reporting</li>
                    <li>Azure DevOps para CI/CD de modelos</li>
                </ul>
                
                <p><strong>Flujo de Datos:</strong></p>
                <ol class="doc-steps">
                    <li>
                        <strong>Ingesta de Datos</strong><br>
                        Recopilaci√≥n de datos desde m√∫ltiples fuentes (CRM, web, transaccional).
                    </li>
                    <li>
                        <strong>Procesamiento y Feature Engineering</strong><br>
                        Limpieza, transformaci√≥n y creaci√≥n de variables predictivas.
                    </li>
                    <li>
                        <strong>Entrenamiento de Modelos</strong><br>
                        Entrenamiento y validaci√≥n de modelos con MLOps.
                    </li>
                    <li>
                        <strong>Deployment y Scoring</strong><br>
                        Despliegue de modelos como APIs REST para inferencia en tiempo real.
                    </li>
                    <li>
                        <strong>Monitorizaci√≥n y Reentrenamiento</strong><br>
                        Seguimiento de performance y reentrenamiento autom√°tico.
                    </li>
                </ol>
            </div>
        </div>
        
        <!-- KPIs -->
        <div class="doc-section">
            <h3 class="doc-section-title">
                <span class="icon">üìä</span>
                KPIs y M√©tricas de √âxito
            </h3>
            <div class="doc-section-content">
                <p><strong>M√©tricas T√©cnicas:</strong></p>
                <ul>
                    <li>Precisi√≥n, Recall, F1-Score del modelo</li>
                    <li>AUC-ROC y AUC-PR para clasificaci√≥n</li>
                    <li>Latencia de inferencia (p50, p95, p99)</li>
                    <li>Cobertura de predicciones</li>
                </ul>
                
                <p><strong>M√©tricas de Negocio:</strong></p>
                <ul>
                    <li>ROI del caso de uso</li>
                    <li>Impacto en KPIs clave de negocio</li>
                    <li>Adopci√≥n por usuarios finales</li>
                    <li>Satisfacci√≥n del cliente</li>
                </ul>
            </div>
        </div>
    </div>
</div>



<div class="use-case-container">
    <div class="use-case-header">
        <div class="use-case-icon">üí¨</div>
        <div class="use-case-info">
            <h1>Gesti√≥n de Agentes Conversacionales</h1>
            <p>Plataforma centralizada para crear y gestionar chatbots, asistentes IA y sistemas multiagente.</p>
        </div>
        <button class="btn btn-primary" onclick="abrirModalCrearChatbot()">
            <span style="font-size: 18px;">+</span> Crear Nuevo Agente
        </button>
    </div>

    <!-- M√©tricas Globales -->
    <div class="metrics-grid-chatbot">
        <div class="metric-card-chatbot">
            <div class="metric-icon-chatbot">üí¨</div>
            <div class="metric-content-chatbot">
                <div class="metric-value-chatbot">{{ metricas.total_conversaciones|format_number }}</div>
                <div class="metric-label-chatbot">Conversaciones/Mes</div>
            </div>
        </div>
        <div class="metric-card-chatbot">
            <div class="metric-icon-chatbot">‚≠ê</div>
            <div class="metric-content-chatbot">
                <div class="metric-value-chatbot">{{ metricas.satisfaccion_promedio }}/5</div>
                <div class="metric-label-chatbot">Satisfacci√≥n Promedio</div>
            </div>
        </div>
        <div class="metric-card-chatbot">
            <div class="metric-icon-chatbot">‚úÖ</div>
            <div class="metric-content-chatbot">
                <div class="metric-value-chatbot">{{ metricas.resolucion_automatica }}%</div>
                <div class="metric-label-chatbot">Resoluci√≥n Autom√°tica</div>
            </div>
        </div>
        <div class="metric-card-chatbot">
            <div class="metric-icon-chatbot">üí∞</div>
            <div class="metric-content-chatbot">
                <div class="metric-value-chatbot">‚Ç¨{{ (metricas.ahorro_mensual / 1000)|round(0)|int }}K</div>
                <div class="metric-label-chatbot">Ahorro Mensual</div>
            </div>
        </div>
    </div>

    <!-- Tabla de Chatbots Activos -->
    <div class="card">
        <div class="card-header">
            <h2>ü§ñ Agentes Conversacionales Activos</h2>
            <div class="header-badges">
                <span class="badge badge-success">{{ metricas.chatbots_activos }} Activos</span>
                <span class="badge badge-warning">{{ metricas.chatbots_desarrollo }} En Desarrollo</span>
            </div>
        </div>
        <div class="card-body" style="padding: 0;">
            <div class="chatbots-table-container">
                <table class="chatbots-table">
                    <thead>
                        <tr>
                            <th>Agente</th>
                            <th>Tipo</th>
                            <th>Estado</th>
                            <th>Conversaciones/Mes</th>
                            <th>Satisfacci√≥n</th>
                            <th>Resoluci√≥n Auto</th>
                            <th>Tiempo Respuesta</th>
                            <th>Canales</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for chatbot in chatbots %}
                        <tr class="chatbot-row">
                            <td>
                                <div class="chatbot-info">
                                    <div class="chatbot-avatar">{{ chatbot.nombre[0] }}</div>
                                    <div>
                                        <div class="chatbot-nombre">{{ chatbot.nombre }}</div>
                                        <div class="chatbot-id">{{ chatbot.id }}</div>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <span class="tipo-badge tipo-{{ chatbot.tipo_corto|lower }}">
                                    {{ chatbot.tipo_corto }}
                                </span>
                                <div class="tipo-descripcion">{{ chatbot.tipo }}</div>
                            </td>
                            <td>
                                <span class="estado-badge estado-{{ chatbot.estado }}">
                                    {% if chatbot.estado == 'activo' %}
                                        ‚óè Activo
                                    {% else %}
                                        ‚óê En Desarrollo
                                    {% endif %}
                                </span>
                            </td>
                            <td>
                                <div class="metric-cell">
                                    <div class="metric-cell-value">{{ chatbot.conversaciones_mes|format_number }}</div>
                                    <div class="metric-cell-label">conversaciones</div>
                                </div>
                            </td>
                            <td>
                                <div class="satisfaction-cell">
                                    <div class="stars">
                                        {% for i in range(5) %}
                                            {% if i < chatbot.satisfaccion|int %}
                                                ‚≠ê
                                            {% else %}
                                                ‚òÜ
                                            {% endif %}
                                        {% endfor %}
                                    </div>
                                    <div class="satisfaction-value">{{ chatbot.satisfaccion }}/5</div>
                                </div>
                            </td>
                            <td>
                                <div class="progress-cell">
                                    <div class="progress-bar-small">
                                        <div class="progress-fill-small" style="width: {{ chatbot.resolucion_automatica }}%"></div>
                                    </div>
                                    <span class="progress-value">{{ chatbot.resolucion_automatica }}%</span>
                                </div>
                            </td>
                            <td>
                                <span class="tiempo-badge">‚ö° {{ chatbot.tiempo_respuesta }}</span>
                            </td>
                            <td>
                                <div class="canales-cell">
                                    {% for canal in chatbot.canales %}
                                        <span class="canal-badge">{{ canal }}</span>
                                    {% endfor %}
                                </div>
                            </td>
                            <td>
                                <div class="acciones-cell">
                                    <button class="btn-icon" title="Ver Detalles" onclick="verDetalles('{{ chatbot.id }}')">
                                        üëÅÔ∏è
                                    </button>
                                    <button class="btn-icon" title="Editar" onclick="editarChatbot('{{ chatbot.id }}')">
                                        ‚úèÔ∏è
                                    </button>
                                    <button class="btn-icon" title="Anal√≠ticas" onclick="verAnaliticas('{{ chatbot.id }}')">
                                        üìä
                                    </button>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Modal Crear Nuevo Chatbot -->
<div id="modalCrearChatbot" class="modal-overlay" style="display: none;">
    <div class="modal-container">
        <div class="modal-header">
            <h2>ü§ñ Crear Nuevo Agente Conversacional</h2>
            <button class="modal-close" onclick="cerrarModalCrearChatbot()">√ó</button>
        </div>
        <div class="modal-body">
            <p class="modal-description">Selecciona el tipo de agente que mejor se adapte a tu caso de uso:</p>
            
            <div class="tipo-chatbot-grid">
                <!-- Chatbot Basado en Flujos -->
                <div class="tipo-chatbot-card" onclick="seleccionarTipo('flujos')">
                    <div class="tipo-icon">üîÑ</div>
                    <h3>Chatbot Basado en Flujos</h3>
                    <p>Conversaciones estructuradas con flujos predefinidos. Ideal para FAQs y procesos simples.</p>
                    <ul class="tipo-features">
                        <li>‚úì Configuraci√≥n visual sin c√≥digo</li>
                        <li>‚úì Respuestas r√°pidas y precisas</li>
                        <li>‚úì F√°cil mantenimiento</li>
                        <li>‚úì Bajo coste</li>
                    </ul>
                    <div class="tipo-badge-modal tipo-flujos">Flujos</div>
                </div>

                <!-- Asistente con IA Generativa -->
                <div class="tipo-chatbot-card featured" onclick="seleccionarTipo('genai')">
                    <div class="featured-badge">Recomendado</div>
                    <div class="tipo-icon">üß†</div>
                    <h3>Asistente con IA Generativa</h3>
                    <p>Conversaciones naturales con GPT-4. Entiende contexto y genera respuestas personalizadas.</p>
                    <ul class="tipo-features">
                        <li>‚úì Lenguaje natural avanzado</li>
                        <li>‚úì Contexto conversacional</li>
                        <li>‚úì Respuestas personalizadas</li>
                        <li>‚úì Aprendizaje continuo</li>
                    </ul>
                    <div class="tipo-badge-modal tipo-genai">GenAI</div>
                </div>

                <!-- Agente -->
                <div class="tipo-chatbot-card" onclick="seleccionarTipo('agente')">
                    <div class="tipo-icon">üéØ</div>
                    <h3>Agente</h3>
                    <p>Agente aut√≥nomo que puede ejecutar acciones y tomar decisiones basadas en objetivos.</p>
                    <ul class="tipo-features">
                        <li>‚úì Toma de decisiones aut√≥noma</li>
                        <li>‚úì Ejecuci√≥n de acciones</li>
                        <li>‚úì Integraci√≥n con sistemas</li>
                        <li>‚úì Razonamiento avanzado</li>
                    </ul>
                    <div class="tipo-badge-modal tipo-agente">Agente</div>
                </div>

                <!-- Sistema Multiagente -->
                <div class="tipo-chatbot-card" onclick="seleccionarTipo('multiagente')">
                    <div class="tipo-icon">üë•</div>
                    <h3>Sistema Multiagente</h3>
                    <p>M√∫ltiples agentes especializados trabajando en colaboraci√≥n para resolver tareas complejas.</p>
                    <ul class="tipo-features">
                        <li>‚úì Agentes especializados</li>
                        <li>‚úì Colaboraci√≥n entre agentes</li>
                        <li>‚úì Tareas complejas</li>
                        <li>‚úì Alta escalabilidad</li>
                    </ul>
                    <div class="tipo-badge-modal tipo-multi-agent">Multi-Agent</div>
                </div>

                <!-- Sistema Multiagente con Orquestador -->
                <div class="tipo-chatbot-card" onclick="seleccionarTipo('orquestador')">
                    <div class="tipo-icon">üéº</div>
                    <h3>Sistema Multiagente con Orquestador</h3>
                    <p>Sistema avanzado con orquestador central que coordina m√∫ltiples agentes especializados.</p>
                    <ul class="tipo-features">
                        <li>‚úì Orquestaci√≥n inteligente</li>
                        <li>‚úì Coordinaci√≥n centralizada</li>
                        <li>‚úì Workflows complejos</li>
                        <li>‚úì M√°xima flexibilidad</li>
                    </ul>
                    <div class="tipo-badge-modal tipo-orquestador">Orquestador</div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="cerrarModalCrearChatbot()">Cancelar</button>
            <button class="btn btn-primary" onclick="confirmarCreacion()">Continuar</button>
        </div>
    </div>
</div>

<style>
/* Estilos espec√≠ficos para gesti√≥n de chatbots */
.use-case-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--spacing-xl);
}

.metrics-grid-chatbot {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: var(--spacing-l);
    margin-bottom: var(--spacing-xl);
}

.metric-card-chatbot {
    background: var(--neutral-background-1);
    border-radius: var(--border-radius-large);
    padding: var(--spacing-l);
    border: 1px solid var(--neutral-stroke-1);
    display: flex;
    align-items: center;
    gap: var(--spacing-m);
    transition: all var(--duration-fast) var(--curve-easy-ease);
}

.metric-card-chatbot:hover {
    box-shadow: var(--shadow-8);
    transform: translateY(-2px);
}

.metric-icon-chatbot {
    font-size: 40px;
}

.metric-value-chatbot {
    font-size: var(--font-size-700);
    font-weight: var(--font-weight-bold);
    color: var(--neutral-foreground-1);
}

.metric-label-chatbot {
    font-size: var(--font-size-200);
    color: var(--neutral-foreground-3);
}

.header-badges {
    display: flex;
    gap: var(--spacing-s);
}

.chatbots-table-container {
    overflow-x: auto;
}

.chatbots-table {
    width: 100%;
    border-collapse: collapse;
}

.chatbots-table thead {
    background: var(--neutral-background-2);
}

.chatbots-table th {
    padding: var(--spacing-m);
    text-align: left;
    font-size: var(--font-size-200);
    font-weight: var(--font-weight-semibold);
    color: var(--neutral-foreground-2);
    border-bottom: 2px solid var(--neutral-stroke-1);
}

.chatbots-table td {
    padding: var(--spacing-l) var(--spacing-m);
    border-bottom: 1px solid var(--neutral-stroke-1);
}

.chatbot-row:hover {
    background: var(--neutral-background-2);
}

.chatbot-info {
    display: flex;
    align-items: center;
    gap: var(--spacing-m);
}

.chatbot-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: linear-gradient(135deg, #0078D4, #106EBE);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: var(--font-weight-bold);
    font-size: 18px;
}

.chatbot-nombre {
    font-weight: var(--font-weight-semibold);
    color: var(--neutral-foreground-1);
}

.chatbot-id {
    font-size: var(--font-size-100);
    color: var(--neutral-foreground-3);
    font-family: 'Consolas', monospace;
}

.tipo-badge {
    display: inline-block;
    padding: 4px 12px;
    border-radius: var(--border-radius-small);
    font-size: var(--font-size-100);
    font-weight: var(--font-weight-semibold);
    text-transform: uppercase;
}

.tipo-flujos { background: #E6F2FA; color: #0078D4; }
.tipo-genai { background: #DFF6DD; color: #107C10; }
.tipo-agente { background: #FFF4EC; color: #F7630C; }
.tipo-multi-agent { background: #FDE7E9; color: #D13438; }
.tipo-orquestador { background: #F3E5F5; color: #8E24AA; }

.tipo-descripcion {
    font-size: var(--font-size-100);
    color: var(--neutral-foreground-3);
    margin-top: 2px;
}

.estado-badge {
    padding: 4px 12px;
    border-radius: var(--border-radius-small);
    font-size: var(--font-size-200);
    font-weight: var(--font-weight-semibold);
}

.estado-activo {
    background: var(--success-light);
    color: var(--success);
}

.estado-desarrollo {
    background: var(--warning-light);
    color: var(--warning);
}

.metric-cell-value {
    font-weight: var(--font-weight-semibold);
    color: var(--neutral-foreground-1);
}

.metric-cell-label {
    font-size: var(--font-size-100);
    color: var(--neutral-foreground-3);
}

.satisfaction-cell {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.stars {
    font-size: 14px;
    letter-spacing: 2px;
}

.satisfaction-value {
    font-size: var(--font-size-200);
    font-weight: var(--font-weight-semibold);
    color: var(--neutral-foreground-2);
}

.progress-cell {
    display: flex;
    align-items: center;
    gap: var(--spacing-s);
}

.progress-bar-small {
    width: 60px;
    height: 6px;
    background: var(--neutral-background-4);
    border-radius: 3px;
    overflow: hidden;
}

.progress-fill-small {
    height: 100%;
    background: linear-gradient(90deg, #107C10, #0E700E);
    transition: width var(--duration-slow) var(--curve-decelerate-max);
}

.progress-value {
    font-size: var(--font-size-200);
    font-weight: var(--font-weight-semibold);
    color: var(--neutral-foreground-2);
}

.tiempo-badge {
    padding: 4px 8px;
    background: var(--neutral-background-3);
    border-radius: var(--border-radius-small);
    font-size: var(--font-size-200);
    font-weight: var(--font-weight-semibold);
}

.canales-cell {
    display: flex;
    flex-wrap: wrap;
    gap: 4px;
}

.canal-badge {
    padding: 2px 8px;
    background: var(--primary-light);
    color: var(--primary);
    border-radius: var(--border-radius-small);
    font-size: var(--font-size-100);
    font-weight: var(--font-weight-semibold);
}

.acciones-cell {
    display: flex;
    gap: var(--spacing-xs);
}

.btn-icon {
    width: 32px;
    height: 32px;
    border: none;
    background: var(--neutral-background-3);
    border-radius: var(--border-radius-small);
    cursor: pointer;
    font-size: 16px;
    transition: all var(--duration-fast) var(--curve-easy-ease);
}

.btn-icon:hover {
    background: var(--primary);
    transform: scale(1.1);
}

/* Modal Styles */
.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(4px);
    z-index: 1000;
    display: flex;
    align-items: center;
    justify-content: center;
    animation: fadeIn 0.2s ease-out;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

.modal-container {
    background: var(--neutral-background-1);
    border-radius: var(--border-radius-large);
    max-width: 1200px;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: var(--shadow-64);
    animation: slideUp 0.3s ease-out;
}

@keyframes slideUp {
    from {
        transform: translateY(20px);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}

.modal-header {
    padding: var(--spacing-xl);
    border-bottom: 1px solid var(--neutral-stroke-1);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modal-header h2 {
    margin: 0;
    font-size: var(--font-size-600);
}

.modal-close {
    width: 40px;
    height: 40px;
    border: none;
    background: var(--neutral-background-3);
    border-radius: 50%;
    font-size: 24px;
    cursor: pointer;
    transition: all var(--duration-fast) var(--curve-easy-ease);
}

.modal-close:hover {
    background: var(--danger-light);
    color: var(--danger);
    transform: rotate(90deg);
}

.modal-body {
    padding: var(--spacing-xl);
}

.modal-description {
    font-size: var(--font-size-300);
    color: var(--neutral-foreground-2);
    margin-bottom: var(--spacing-xl);
}

.tipo-chatbot-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: var(--spacing-l);
}

.tipo-chatbot-card {
    background: var(--neutral-background-2);
    border: 2px solid var(--neutral-stroke-1);
    border-radius: var(--border-radius-large);
    padding: var(--spacing-l);
    cursor: pointer;
    transition: all var(--duration-fast) var(--curve-easy-ease);
    position: relative;
}

.tipo-chatbot-card:hover {
    border-color: var(--primary);
    box-shadow: var(--shadow-8);
    transform: translateY(-4px);
}

.tipo-chatbot-card.featured {
    border-color: var(--primary);
    background: linear-gradient(135deg, var(--primary-light) 0%, var(--neutral-background-2) 100%);
}

.featured-badge {
    position: absolute;
    top: -12px;
    right: 20px;
    background: var(--primary);
    color: white;
    padding: 4px 12px;
    border-radius: var(--border-radius-medium);
    font-size: var(--font-size-100);
    font-weight: var(--font-weight-semibold);
}

.tipo-icon {
    font-size: 48px;
    margin-bottom: var(--spacing-m);
}

.tipo-chatbot-card h3 {
    font-size: var(--font-size-400);
    margin: 0 0 var(--spacing-s) 0;
}

.tipo-chatbot-card p {
    font-size: var(--font-size-200);
    color: var(--neutral-foreground-3);
    margin-bottom: var(--spacing-m);
}

.tipo-features {
    list-style: none;
    padding: 0;
    margin: var(--spacing-m) 0;
}

.tipo-features li {
    font-size: var(--font-size-200);
    color: var(--neutral-foreground-2);
    margin-bottom: var(--spacing-xs);
}

.tipo-badge-modal {
    display: inline-block;
    padding: 6px 12px;
    border-radius: var(--border-radius-small);
    font-size: var(--font-size-100);
    font-weight: var(--font-weight-semibold);
    text-transform: uppercase;
    margin-top: var(--spacing-m);
}

.modal-footer {
    padding: var(--spacing-l) var(--spacing-xl);
    border-top: 1px solid var(--neutral-stroke-1);
    display: flex;
    justify-content: flex-end;
    gap: var(--spacing-m);
}
</style>

{% endblock %}

{% block extra_js %}
<script>
let tipoSeleccionado = null;

function abrirModalCrearChatbot() {
    document.getElementById('modalCrearChatbot').style.display = 'flex';
    tipoSeleccionado = null;
}

function cerrarModalCrearChatbot() {
    document.getElementById('modalCrearChatbot').style.display = 'none';
    // Remover selecci√≥n
    document.querySelectorAll('.tipo-chatbot-card').forEach(card => {
        card.style.borderColor = '';
        card.style.boxShadow = '';
    });
}

function seleccionarTipo(tipo) {
    tipoSeleccionado = tipo;
    
    // Remover selecci√≥n anterior
    document.querySelectorAll('.tipo-chatbot-card').forEach(card => {
        card.style.borderColor = '';
        card.style.boxShadow = '';
    });
    
    // Marcar selecci√≥n actual
    event.currentTarget.style.borderColor = 'var(--primary)';
    event.currentTarget.style.boxShadow = 'var(--shadow-16)';
}

function confirmarCreacion() {
    if (!tipoSeleccionado) {
        alert('Por favor, selecciona un tipo de agente');
        return;
    }
    
    // Simular creaci√≥n
    alert(`Creando agente de tipo: ${tipoSeleccionado}\n\nEn un entorno real, esto abrir√≠a un formulario de configuraci√≥n detallado.`);
    cerrarModalCrearChatbot();
}

function verDetalles(chatbotId) {
    alert(`Ver detalles del chatbot: ${chatbotId}\n\nEn un entorno real, esto abrir√≠a una vista detallada con m√©tricas, conversaciones y configuraci√≥n.`);
}

function editarChatbot(chatbotId) {
    alert(`Editar chatbot: ${chatbotId}\n\nEn un entorno real, esto abrir√≠a el editor de configuraci√≥n del chatbot.`);
}

function verAnaliticas(chatbotId) {
    alert(`Ver anal√≠ticas del chatbot: ${chatbotId}\n\nEn un entorno real, esto abrir√≠a un dashboard con m√©tricas detalladas, gr√°ficos de conversaciones, satisfacci√≥n, etc.`);
}

function enviarMensaje() {
    const input = document.getElementById('chat-input');
    const mensaje = input.value.trim();
    if (!mensaje) return;

    const messagesContainer = document.getElementById('chat-messages');
    
    // Agregar mensaje del usuario
    const userMsg = document.createElement('div');
    userMsg.className = 'chat-message user-message';
    userMsg.innerHTML = `
        <div class="message-bubble">
            <p>${mensaje}</p>
        </div>
        <div class="message-avatar">üë§</div>
    `;
    messagesContainer.appendChild(userMsg);
    
    input.value = '';
    messagesContainer.scrollTop = messagesContainer.scrollHeight;

    // Mostrar indicador de escritura
    const typingIndicator = document.createElement('div');
    typingIndicator.className = 'chat-message bot-message typing-indicator';
    typingIndicator.id = 'typing-indicator';
    typingIndicator.innerHTML = `
        <div class="message-avatar">ü§ñ</div>
        <div class="message-bubble">
            <div class="typing-dots">
                <span></span><span></span><span></span>
            </div>
        </div>
    `;
    messagesContainer.appendChild(typingIndicator);
    messagesContainer.scrollTop = messagesContainer.scrollHeight;

    // Enviar a API
    fetch('/api/chatbot', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ mensaje: mensaje })
    })
    .then(response => response.json())
    .then(data => {
        setTimeout(() => {
            // Remover indicador de escritura
            document.getElementById('typing-indicator').remove();
            
            // Agregar respuesta del bot
            const botMsg = document.createElement('div');
            botMsg.className = 'chat-message bot-message';
            
            let accionesHTML = '';
            if (data.acciones && data.acciones.length > 0) {
                accionesHTML = '<div class="message-actions">';
                data.acciones.forEach(accion => {
                    accionesHTML += `<button class="btn btn-sm btn-outline">${accion}</button>`;
                });
                accionesHTML += '</div>';
            }
            
            botMsg.innerHTML = `
                <div class="message-avatar">ü§ñ</div>
                <div class="message-bubble">
                    <p>${data.texto}</p>
                    ${accionesHTML}
                </div>
            `;
            messagesContainer.appendChild(botMsg);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }, 1000);
    })
    .catch(error => {
        document.getElementById('typing-indicator').remove();
        console.error('Error:', error);
    });
}

function preguntaRapida(pregunta) {
    document.getElementById('chat-input').value = pregunta;
    enviarMensaje();
}
</script>
{% endblock %}
